<!DOCTYPE html>
<html>

<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, height=device-height, initial-scale=1, minimum-scale=1, maximum-scale=1.5, user-scalable=1">
    <title>Start</title>
    <link rel="stylesheet" type="text/css" href="css/page.css" />
    <link rel="stylesheet" type="text/css" href="css/jquery.mobile-1.2.0.css">
    <link rel="stylesheet" type="text/css" href="css/flexslider.css">
    <!--link rel="stylesheet" type="text/css" href="css/style.css" /-->
    <link rel="stylesheet" type="text/css" href="css/login/style.css" />
    <link rel="stylesheet" type="text/css" href="css/start/style.css">
    <link rel="stylesheet" type="text/css" href="css/learn/style.css">
    <link rel="stylesheet" type="text/css" href="css/ready/style.css">
    <link rel="stylesheet" type="text/css" href="css/doing/style.css" />
    <link rel="stylesheet" type="text/css" href="css/show/style.css" />
    <link rel="stylesheet" type="text/css" href="css/track.css" />
    <script src="js/cordova.js"></script>
    <script src="js/jquery-1.8.2.min.js"></script>
    <script src="js/jquery.mobile-1.2.0.min.js"></script>
    <script src="js/jquery.flexslider-min.js"></script>
    <script type="text/javascript" charset="utf-8" src="js/video.js"></script>
    <script type="text/javascript" charset="utf-8" src="js/pebble.js"></script>
    <script type="text/javascript" charset="utf-8" src="js/gball.js"></script>
    <script type="text/javascript" charset="utf-8" src="js/smartWatch2.js"></script>
    <script type="text/javascript" charset="utf-8" src="js/PluginTest.js"></script>
    <script type="text/javascript" charset="utf-8" src="js/page.js"></script>
	<script type="text/javascript" charset="utf-8" src="js/AndroidWear.js"></script>
    <script type="text/javascript">
    /*$(window).load(function(){
                                                                        $('.flexslider').flexslider({
                                                                            animation: "fade",
                                                                            direction: "horizontal",
                                                                            animationSpeed: 1000,
                                                                            slideshow: false
                                                                        });
                                                                    });*/
    localStorage.setItem("get_index", "w");
    document.addEventListener("deviceready", onDeviceReady, false);
    var db = window.openDatabase("Dummy_DB", "1.0", "Dummy_DB", 200000);
    var tab = "&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp"; //x: y: z: 間距用    
    var tabb = "&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp"; //mySql data-head用
    var tabbb = tabb + "&nbsp&nbsp&nbsp&nbsp&nbsp"; //mySql data-detail用
    var tabl = "&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp"; //mySql data-head用
    var side_global = 0;
    var level_global = 0;
    var firsttime = 0; //第一次split的x不要理他
    //var xyz=new Array(); //外接硬體的xyz數據
    var xyz = new Array();; //外接硬體的xyz數據

    var errortime = 0; //確保達到2000時不會關閉兩次
    var tempid;
    var id_count; //上傳server個人index count
    var reha_name; //復健動作名稱
    var fd; //日期
    var ft; //結束時間 
    var Startime; //開始時間
    var type; //動作類型(細分6種)
    var degree; //角度
    var num; //建議次數
    var count; //成功次數
    var error_count; //失敗次數
    var f_count; //失敗次數
    var watchID = null;
    var pe_frequency; //Pebble傳值的頻率

    var test = 0; //動作程序到哪
    var cc = 0; //點我返回點到哪
    var Shour; //記錄開始的時間
    var Sminute;
    var Ssecond;
    var processlength; //進度條的單位長度
    var lock = false; //確認是否有連接手錶  false:有連接  true:無連接
    var more = false; //避免開始鍵第二次產生作用
    // 重力球變數
    var watch = 0;
    var cnv;
    var target;
    var xPos;
    var yPos;
    var canvas;
    //smartwatch2變數
    var smartWatch2_frequency;
    var smartWatch2_xyz = new Array();
    //手錶選擇變數
    var watch_choice = 0;
    var watch_type = 0; //手錶變數種類，有百位有個位
    var userId;
    var tool_choose = 1;
    var tempdata = new Array(); //放處方籤資料
    var tempdata2 = new Array(); // 放日期資料
    var tempdata3 = new Array(); // 放日期資料
    var stringWatch;
    var d = new Date();
    var year = d.getFullYear();
    var month = d.getMonth() + 1;
    var date = d.getDate();
    var hour = d.getHours();
    var minute = d.getMinutes();
    var second = d.getSeconds();
    var ttt4;
    // Test
    var test_count = 1;
	
	//顯示加速度以判斷手錶
	var show = 0;
    // 動作判斷常數
    // 上舉 左手
    var type1_start_lowerbound_x = 550;
    var type1_start_upperbound_x = 750;
    var type1_start_lowerbound_y = 636;
    var type1_start_upperbound_y = 876;
    var type1_fail_lowerbound_y = 1100;
    var type1_fail_lowerbound_z = 1100;
    var type1_fail_upperbound_z = -1000;
    // 90度
    var type1_90_success_upperbound_x = 488;
    var type1_90_success_lowerbound_y = 886;
    var type1_90_success_upperbound_y = 1120;
    // 120度
    var type1_120_success_lowerbound_x = -696;
    var type1_120_success_upperbound_x = -510;
    var type1_120_success_lowerbound_y = 440;
    var type1_120_success_upperbound_y = 644;
    // 180度
    var type1_180_success_lowerbound_x = -992;
    var type1_180_success_upperbound_x = -896;
    var type1_180_success_upperbound_y = 120;
    // 下放
    var type2_start_lowerbound_x = 550;
    var type2_start_upperbound_x = 750;
    var type2_start_lowerbound_y = 656;
    var type2_start_upperbound_y = 1076;
    var type2_success_lowerbound_x = 788;
    var type2_success_upperbound_y = 568;
    // 摸耳朵
    var type35_start_lowerbound_x = -550;
    var type35_start_upperbound_x = -200;
    var type35_start_lowerbound_y = 203;
    var type35_start_upperbound_y = 752;
    var type35_start_lowerbound_z = -950;
    var type35_start_upperbound_z = -600;
    var type46_start_lowerbound_x = 300;
    var type46_start_upperbound_x = 700;
    var type46_start_lowerbound_y = 212;
    var type46_start_upperbound_y = 752;
    var type46_start_lowerbound_z = -952;
    var type46_start_upperbound_z = -554;
    // 右手肩膀
    var type3_success_lowerbound_x = 468;
    var type3_success_upperbound_x = 826;
    var type3_success_lowerbound_y = 600;
    var type3_success_upperbound_y = 950;
    var type3_success_lowerbound_z = -600;
    var type3_success_upperbound_z = -150;
    // 左手肩膀
    var type4_success_lowerbound_x = -868;
    var type4_success_upperbound_x = -464;
    var type4_success_lowerbound_y = 100;
    var type4_success_upperbound_y = 628;
    var type4_success_lowerbound_z = -732;
    var type4_success_upperbound_z = -120;
    // 右手耳朵
    var type5_success_lowerbound_x = 644;
    var type5_success_upperbound_x = 980;
    var type5_success_lowerbound_y = 350;
    var type5_success_upperbound_y = 640;
    var type5_success_lowerbound_z = 50;
    var type5_success_upperbound_z = 450;
    // 左手耳朵
    var type6_success_lowerbound_x = -950;
    var type6_success_upperbound_x = -450;
    var type6_success_lowerbound_y = 350;
    var type6_success_upperbound_y = 850;
    var type6_success_lowerbound_z = -150;
    var type6_success_upperbound_z = 400;
    // 踢腿
    var type7_start_lowerbound_x = 892;
    var type7_start_upperbound_x = 1032;
    var type7_start_lowerbound_y = -204;
    var type7_start_upperbound_y = 192;
    var type7_fail_upperbound_z = -550;
    var type7_fail_lowerbound_z = 500;
    var type7_success_lowerbound_x = -320;
    var type7_success_upperbound_x = 311;
    var type7_success_lowerbound_y = -1064;
    var type7_success_upperbound_y = -668;
    // 挺腹
    var type8_start_lowerbound_x = 604;
    var type8_start_upperbound_x = 804;
    var type8_start_lowerbound_y = 556;
    var type8_start_upperbound_y = 756;
    var type8_success_lowerbound_x = 252;
    var type8_success_upperbound_x = 452;
    var type8_success_lowerbound_y = 820;
    var type8_success_upperbound_y = 1020;
    var type8_success_lowerbound_z = -400;
    var type8_success_upperbound_z = 400;
    // 側抬腿
    var type9_start_lowerbound_x = -1088;
    var type9_start_upperbound_x = -856;
    var type9_start_lowerbound_y = -256;
    var type9_start_upperbound_y = 272;
    var type9_start_lowerbound_z = -304;
    var type9_start_upperbound_z = 312;
    var type9_fail_upperbound_y = -1100;
    var type9_fail_lowerbound_y = 1100;
    var type9_success_lowerbound_x = -888;
    var type9_success_upperbound_x = -550;
    var type9_success_lowerbound_y = -288;
    var type9_success_upperbound_y = 108;
    var type9_success_lowerbound_z = 333;
    var type9_success_upperbound_z = 790;
    //watch1變數-----------------------------------------------------
    // 上舉
    var watch1_type1_start_lowerbound_x = 5.5;
    var watch1_type1_start_upperbound_x = 7.5;
    var watch1_type1_start_lowerbound_y = 6.56;
    var watch1_type1_start_upperbound_y = 10.76;
    var watch1_type1_fail_lowerbound_y = 11;
    var watch1_type1_fail_lowerbound_z = 10;
    var watch1_type1_fail_upperbound_z = -10;
    // 90度
    var watch1_type1_90_success_upperbound_x = 4.88;
    var watch1_type1_90_success_lowerbound_y = 7.16;
    var watch1_type1_90_success_upperbound_y = 11.2;
    // 120度
    var watch1_type1_120_success_lowerbound_x = -6.96;
    var watch1_type1_120_success_upperbound_x = -5.1;
    var watch1_type1_120_success_lowerbound_y = 4.4;
    var watch1_type1_120_success_upperbound_y = 6.44;
    // 180度
    var watch1_type1_180_success_lowerbound_x = -9.92;
    var watch1_type1_180_success_upperbound_x = -8.96;
    var watch1_type1_180_success_upperbound_y = 1.2;
    // 下放
    var watch1_type2_start_lowerbound_x = 5.5;
    var watch1_type2_start_upperbound_x = 7.5;
    var watch1_type2_start_lowerbound_y = 6.56;
    var watch1_type2_start_upperbound_y = 10.76;
    var watch1_type2_success_lowerbound_x = 7.88;
    var watch1_type2_success_upperbound_y = 5.68;
    // 摸耳朵
    var watch1_type35_start_lowerbound_x = -5.5;
    var watch1_type35_start_upperbound_x = -2;
    var watch1_type35_start_lowerbound_y = 2.03;
    var watch1_type35_start_upperbound_y = 7.52;
    var watch1_type35_start_lowerbound_z = -9.5;
    var watch1_type35_start_upperbound_z = -6;
    var watch1_type46_start_lowerbound_x = 3;
    var watch1_type46_start_upperbound_x = 7;
    var watch1_type46_start_lowerbound_y = 2.12;
    var watch1_type46_start_upperbound_y = 7.52;
    var watch1_type46_start_lowerbound_z = -9.52;
    var watch1_type46_start_upperbound_z = -5.54;
    // 右手肩膀
    var watch1_type3_success_lowerbound_x = 4.68;
    var watch1_type3_success_upperbound_x = 8.26;
    var watch1_type3_success_lowerbound_y = 6;
    var watch1_type3_success_upperbound_y = 9.5;
    var watch1_type3_success_lowerbound_z = -6;
    var watch1_type3_success_upperbound_z = -1.5;
    // 左手肩膀
    var watch1_type4_success_lowerbound_x = -8.68;
    var watch1_type4_success_upperbound_x = -4.64;
    var watch1_type4_success_lowerbound_y = 1;
    var watch1_type4_success_upperbound_y = 6.28;
    var watch1_type4_success_lowerbound_z = -7.32;
    var watch1_type4_success_upperbound_z = -1.2;
    // 右手耳朵
    var watch1_type5_success_lowerbound_x = 6.44;
    var watch1_type5_success_upperbound_x = 9.8;
    var watch1_type5_success_lowerbound_y = 3.5;
    var watch1_type5_success_upperbound_y = 6.4;
    var watch1_type5_success_lowerbound_z = 0.5;
    var watch1_type5_success_upperbound_z = 4.5;
    // 左手耳朵
    var watch1_type6_success_lowerbound_x = -9.5;
    var watch1_type6_success_upperbound_x = -4.5;
    var watch1_type6_success_lowerbound_y = 3.5;
    var watch1_type6_success_upperbound_y = 8.5;
    var watch1_type6_success_lowerbound_z = -1.5;
    var watch1_type6_success_upperbound_z = 4;
    // 踢腿
    var watch1_type7_start_lowerbound_x = 8.92;
    var watch1_type7_start_upperbound_x = 10.32;
    var watch1_type7_start_lowerbound_y = -2.04;
    var watch1_type7_start_upperbound_y = 1.92;
    var watch1_type7_fail_upperbound_z = -5.5;
    var watch1_type7_fail_lowerbound_z = 5;
    var watch1_type7_success_lowerbound_x = -3.2;
    var watch1_type7_success_upperbound_x = 3.11;
    var watch1_type7_success_lowerbound_y = -10.64;
    var watch1_type7_success_upperbound_y = -6.68;
    // 挺腹
    var watch1_type8_start_lowerbound_x = 6.04;
    var watch1_type8_start_upperbound_x = 8.04;
    var watch1_type8_start_lowerbound_y = 5.56;
    var watch1_type8_start_upperbound_y = 7.56;
    var watch1_type8_success_lowerbound_x = 2.52;
    var watch1_type8_success_upperbound_x = 4.52;
    var watch1_type8_success_lowerbound_y = 8.2;
    var watch1_type8_success_upperbound_y = 10.2;
    var watch1_type8_success_lowerbound_z = -4;
    var watch1_type8_success_upperbound_z = 4;
    // 側抬腿
    var watch1_type9_start_lowerbound_x = -10.88;
    var watch1_type9_start_upperbound_x = -8.56;
    var watch1_type9_start_lowerbound_y = -2.56;
    var watch1_type9_start_upperbound_y = 2.72;
    var watch1_type9_start_lowerbound_z = -3.04;
    var watch1_type9_start_upperbound_z = 3.12;
    var watch1_type9_fail_upperbound_y = -11;
    var watch1_type9_fail_lowerbound_y = 11;
    var watch1_type9_success_lowerbound_x = -8.88;
    var watch1_type9_success_upperbound_x = -5.5;
    var watch1_type9_success_lowerbound_y = -2.88;
    var watch1_type9_success_upperbound_y = 1.08;
    var watch1_type9_success_lowerbound_z = 3.33;
    var watch1_type9_success_upperbound_z = 7.9;
	
	//側上斜舉
	var watch1_type10_start_lowerbound_x = -10.88;
    var watch1_type10_start_upperbound_x = -8.56;
    var watch1_type10_start_lowerbound_y = -1;
    var watch1_type10_start_upperbound_y = 1;
    var watch1_type10_start_lowerbound_z = -1;
    var watch1_type10_start_upperbound_z = 1;
    var watch1_type10_fail_upperbound_y = -12;
    var watch1_type10_fail_lowerbound_y = 12;
    var watch1_type10_success_lowerbound_x = -1;
    var watch1_type10_success_upperbound_x = 1;
    var watch1_type10_success_lowerbound_y = -11;
    var watch1_type10_success_upperbound_y = -9;
    var watch1_type10_success_lowerbound_z = -1;
    var watch1_type10_success_upperbound_z = 1;
	
	//手臂內彎
	var watch1_type11_start_lowerbound_x = 8;
    var watch1_type11_start_upperbound_x = 11;
    var watch1_type11_start_lowerbound_y = -2;
    var watch1_type11_start_upperbound_y = 2;
    var watch1_type11_start_lowerbound_z = -2.5;
    var watch1_type11_start_upperbound_z = 2;
	
	var watch1_type11_success_lowerbound_x = -1.5;
	var watch1_type11_success_upperbound_x = 1.5;
	var watch1_type11_success_lowerbound_y = -1.5;
    var watch1_type11_success_upperbound_y = 2;
	var watch1_type11_success_lowerbound_z = 8;
    var watch1_type11_success_upperbound_z = 10;
	
	var watch2_type11_start_lowerbound_x = -7.5;
    var watch2_type11_start_upperbound_x = -3.0;
    var watch2_type11_start_lowerbound_y = -9.5;
    var watch2_type11_start_upperbound_y = -5.5;
    var watch2_type11_start_lowerbound_z = -2.5;
    var watch2_type11_start_upperbound_z = 4;
	
	var watch2_type11_success_lowerbound_x = -3.5;
	var watch2_type11_success_upperbound_x = 0.5;
	var watch2_type11_success_lowerbound_y = -7.5;
    var watch2_type11_success_upperbound_y = -2;
	var watch2_type11_success_lowerbound_z = 4.5;
    var watch2_type11_success_upperbound_z = 11.5;

    function onDeviceReady() {

            db.transaction(populateDB, errorCB, successCB);
            document.addEventListener("backbutton", onBackKeyDown, false);
            fd = year + "/" + month + "/" + date;
            ttt4 = String(fd);
            // document.addEventListener("deviceready", loadBluetoothPlugin, false);
            // document.addEventListener("deviceready", loadSmartWatch2, false);
            // window.plugins.GetValue.passValue(onSuccess_smartWatch2,onError_smartWatch2);

            // window.plugins.Gball.acc(onSuccess_gball,onError_gball);

            playback();
            playmusic();
            $('.flexslider').flexslider({
                animation: "fade",
                direction: "horizontal",
                animationSpeed: 1000,
                slideshow: false,
                smoothHeight: true
            });
            hasID();
            //checkConnectPebble(); 
            $("#gbutton").click(function() {

                init();
            });

            $("#wbutton").click(function() {
                // window.plugins.GetValue.sendValue(onSuccess_smartWatch2GetValue,onError_smartWatch2GetValue);
                // window.plugins.GetValue.passValue(onSuccess_smartWatch2GetValue,onError_smartWatch2GetValue);
                smartWatch2_frequency = setInterval(function() { //每400ms call passValue，pebble便會傳值到手機
                    ///開始傳值 500ms傳一次
                    window.plugins.GetValue.passValue(onSuccess_smartWatch2GetValue, onError_smartWatch2GetValue);
                }, 100);
            });
        }
        //---------------------------------------------重力球----------------------
    function init() {
        var iW = window.innerWidth;
        var iH = window.innerHeight;
        canvas = document.getElementById('myCanvas');
        cnv = canvas.getContext("2d");
        cnv.canvas.width = iW;
        cnv.canvas.height = iH - 40;
        target = new Image();
        target.src = "ball.png";
        xPos = (iW - target.width) / 2;
        yPos = (iH - target.height) / 2;
        target.onload = function() {
            cnv.drawImage(target, xPos, yPos);
        }
        watch = navigator.accelerometer.watchAcceleration(success, failure, {
            frequency: 30
        });

    }

    function success(accel) {
        document.getElementById("xOut").innerHTML = accel.x;
        document.getElementById("yOut").innerHTML = accel.y;
        document.getElementById("zOut").innerHTML = accel.z;
        cnv.clearRect(0, 0, canvas.width, canvas.height);
        xPos += -1 * (accel.x * 3);
        yPos += (accel.y * 3);
        cnv.drawImage(target, xPos, yPos);

    }

    function failure() {
            alert("Error");
        }
        //------------------------------------------------顯示smartwatch值---------------------------
        //          function loadsend()
        //          {

    //       }
    //       function executeFromObjCall(str)
    // {
    //     alert("execute from objective c call params:" + str);

    // }
    function onSuccess_smartWatch2GetValue(r) {

        smartWatch2_xyz = r.split("+", 3);
        document.getElementById("textX").innerHTML = smartWatch2_xyz[0];
        document.getElementById("textY").innerHTML = smartWatch2_xyz[1];
        document.getElementById("textZ").innerHTML = smartWatch2_xyz[2];
    }

    function onError_smartWatch2GetValue() {
            alert("發生錯誤_smartWatch2GetValue!");
        }
        //----------------------------------------------------------------------------------------------
        //按下返回鍵do nothing 讓他沒功能
    function onBackKeyDown() {
        window.location.href = "index.html";

    }

    function loadBluetoothPlugin() { //load pebble bluetooth plugin
        window.plugins = {
            BluetoothPlugin: cordova.require('cordova/plugin/bluetooth'),
            PluginTest: cordova.require('cordova/plugin/PluginTest')
        };
    }
	
	function loadAndroidWear() { //load android wear plugin
        window.plugins = {
            AndroidWear: cordova.require('cordova/plugin/AndroidWear')
        };
    }

    function loadSmartWatch2() { //load smartwatch2 bluetooth plugin
        window.plugins = {
            GetValue: cordova.require('smartWatch2')
        };
    }

    function loadActionData() {

        var querys = "tool_choose=" + tool_choose + "&" + "patient_id=" + userId;
        $.ajax({
            url: "http://health.ncu.cc/get_suggest_value.php",
            type: 'GET',
            data: querys,
            dataType: 'json',
            success: function(json) {

                for (i = 0; i < json.length; i++) {
                    tempdata[i] = new Array(5);
                    // if(json[i]["day"]==fd){


                    tempdata[i][0] = json[i]["action"];
                    tempdata[i][1] = json[i]["times"];
                    tempdata[i][2] = json[i]["angle"];
                    tempdata[i][3] = json[i]["day"];
                    tempdata[i][4] = json[i]["watch_type"];

                    // }else{
                    //  tempdata[i][0]=-1;
                    //  tempdata[i][1]=-1;
                    //  tempdata[i][2]=-1;
                    // }



                    // var a1 = json[i]["action"];
                    // var a2 = json[i]["times"];
                    // var a3 = json[i]["angle"];
                    // switch(Number(json[i]["action"]) ){
                    //  case 0:  //上舉
                    //      var temp = '<button  onclick=getdetail2("' + i + '") >' + "動作: 上舉  角度:"+ a3+" 次數: "+ a2 + "</button>";
                    //      $('#glist').append(temp);

                    //      break;
                    //  case 1:  //下放
                    //      var temp = '<button href="" onclick=getdetail2("' + i + '") >' + "動作: 下放 "+" 次數: "+ a2 + "</button>";
                    //      $('#glist').append(temp);
                    //      break;
                    //  case 2:  //右手摸肩
                    //      var temp = '<button href="" onclick=getdetail2("' + i + '") >' + "動作: 右手摸肩 "+" 次數: "+ a2 + "</button>";
                    //      $('#glist').append(temp);
                    //      break;
                    //  case 3:  //左手摸肩
                    //      var temp = '<button href="" onclick=getdetail2("' + i + '") >' + "動作: 左手摸肩 "+" 次數: "+ a2 + "</button>";
                    //      $('#glist').append(temp);
                    //      break;
                    //  case 4:  //右手摸耳
                    //      var temp = '<button href="" onclick=getdetail2("' + i + '") >' + "動作: 右手摸耳 "+" 次數: "+ a2 + "</button>";
                    //      $('#glist').append(temp);
                    //      break;
                    //  case 5:  //左手摸耳
                    //      var temp = '<button href="" onclick=getdetail2("' + i + '") >' + "動作: 左手摸耳 "+" 次數: "+ a2 + "</button>";
                    //      $('#glist').append(temp);
                    //      break;
                    //  case 6:  //踢腿
                    //      var temp = '<button href="" onclick=getdetail2("' + i + '") >' + "動作: 踢腿 "+" 次數: "+ a2 + "</button>";
                    //      $('#glist').append(temp);
                    //      break;
                    //  case 7:  //挺腹
                    //      var temp = '<button href="" onclick=getdetail2("' + i + '") >' + "動作: 挺腹 "+" 次數: "+ a2 + "</button>";
                    //      $('#glist').append(temp);
                    //      break;
                    //  case 8:  //側抬腿
                    //      var temp = '<button href="" onclick=getdetail2("' + i + '") >' + "動作: 側抬腿 "+" 次數: "+ a2 + "</button>";
                    //      $('#glist').append(temp);
                    //      break;
                    // }

                }
                // $("#glist").trigger('create');

            },
            fail: function(b) {
                alert("失敗");
            }
        });

        loadActionData2();


    }

    function loadActionData2() {
            $("#glist").empty();
            var ttt3;

            var ttt2 = ttt4.split("/", 3);
            if (Number(ttt2[1]) < 10) {
                ttt3 = ttt2[0] + "%2F0" + ttt2[1] + "%2F" + ttt2[2];
            } else {
                ttt3 = ttt2[0] + "%2F" + ttt2[1] + "%2F" + ttt2[2];
            }

            //alert(ttt3);
            var querys = "day=" + ttt3 + "&patient_id=" + userId;


            $.ajax({
                url: "http://health.ncu.cc/get_update_value.php?command=watch",
                type: 'GET',
                data: querys,
                dataType: 'json',
                success: function(json2) {
                    // $("#glist").empty();
                    // for (var k = 0; k <= json2.length; k++){
                    //  tempdata3
                    // }

                    for (var k = 0; k < json2.length; k++) {
                        //alert("5");
                        for (var j = 0; j < tempdata.length; j++) {

                            // tempdata2 = tempdata[j][3].split("-",3);
                            tempdata3[k] = new Array(2);
                            // var tg = tempdata2[0]+"/"+tempdata2[1]+"/"+tempdata2[2];
                            tempdata3[k][0] = json2[k]["action"];
                            tempdata3[k][1] = json2[k]["angle"];

                            if (tempdata3[k][0] == tempdata[j][0] && tempdata3[k][1] == tempdata[j][2]) {
                                // alert("gg");
                                var tempss = Number(tempdata[j][1]) - Number(json2[k]["total"]);
                                //alert(tempss);
                                tempdata[j][1] = String(tempss);

                            }
                        }
                    }

                    for (i = 0; i < tempdata.length; i++) {
                        // if(Number(tempdata[i][0]) == 0 || Number(tempdata[i][0]) == 1 || Number(tempdata[i][0]) == 2 || Number(tempdata[i][0]) ==3 ||Number(tempdata[i][0]) == 4 || Number(tempdata[i][0]) ==5||Number(tempdata[i][0]) ==6||Number(tempdata[i][0]) ==7 ||Number(tempdata[i][0]) == 8){
                        if (Number(tempdata[i][1]) <= 0) {

                        } else {
                            if(Number(tempdata[i][4]) == 0) {
                                stringWatch = "pebble";
                            } else if (Number(tempdata[i][4]) == 1) {
                                stringWatch = "sony";
                            } else{
                                stringWatch = "Geak";
                            }
                            switch (Number(tempdata[i][0])) {

                                case 0: //上舉
                                    var temp = '<button  onclick=getdetail2("' + i + '") >' + "動作: 上舉  角度:" + tempdata[i][2] + " 手錶類型:" + stringWatch + "</button>";
                                    $('#glist').append(temp);

                                    break;
                                case 1: //下放
                                    var temp = '<button href="" onclick=getdetail2("' + i + '") >' + "動作: 下放 " +" 手錶類型:" + stringWatch + "</button>";
                                    $('#glist').append(temp);
                                    break;
                                case 2: //右手摸肩
                                    var temp = '<button href="" onclick=getdetail2("' + i + '") >' + "動作: 右手摸肩 " + " 手錶類型:" + stringWatch + "</button>";
                                    $('#glist').append(temp);
                                    break;
                                case 3: //左手摸肩
                                    var temp = '<button href="" onclick=getdetail2("' + i + '") >' + "動作: 左手摸肩 "  + " 手錶類型:" + stringWatch + "</button>";
                                    $('#glist').append(temp);
                                    break;
                                case 4: //右手摸耳
                                    var temp = '<button href="" onclick=getdetail2("' + i + '") >' + "動作: 右手摸耳 " + " 手錶類型:" + stringWatch + "</button>";
                                    $('#glist').append(temp);
                                    break;
                                case 5: //左手摸耳
                                    var temp = '<button href="" onclick=getdetail2("' + i + '") >' + "動作: 左手摸耳 " + " 手錶類型:" + stringWatch + "</button>";
                                    $('#glist').append(temp);
                                    break;
                                case 6: //踢腿
                                    var temp = '<button href="" onclick=getdetail2("' + i + '") >' + "動作: 踢腿 " +  " 手錶類型:" + stringWatch + "</button>";
                                    $('#glist').append(temp);
                                    break;
                                case 7: //挺腹
                                    var temp = '<button href="" onclick=getdetail2("' + i + '") >' + "動作: 挺腹 " +  " 手錶類型:" + stringWatch + "</button>";
                                    $('#glist').append(temp);
                                    break;
                                case 8: //側抬腿
                                    var temp = '<button href="" onclick=getdetail2("' + i + '") >' + "動作: 側抬腿 " +  " 手錶類型:" + stringWatch + "</button>";
                                    $('#glist').append(temp);
                                    break;
								case 10: //側上斜舉
                                    var temp = '<button href="" onclick=getdetail2("' + i + '") >' + "動作: 側上斜舉 " +  " 手錶類型:" + stringWatch + "</button>";
                                    $('#glist').append(temp);
                                    break;
								case 11: //手部內彎前伸
                                    var temp = '<button href="" onclick=getdetail2("' + i + '") >' + "動作: 手部內彎前伸 " +  " 手錶類型:" + stringWatch + "</button>";
                                    $('#glist').append(temp);
                                    break;
                            }

                        }


                        // }

                    }
                    $("#glist").trigger('create');

                },
                fail: function(b) {
                    alert("失敗");
                }
            });



        }
        // function loadGball(){  //load pebble bluetooth plugin
        //     window.plugins = {
        //      Gball: cordova.require( 'gball' )
        //  };
        // }

    // function loadGeak(){  //load pebble bluetooth plugin
    //      window.plugins = {

    //     };
    //    }
    function getdetail2(sg) {
        var action = Number(tempdata[sg][0]); ////action:動作類型
        num = Number(tempdata[sg][1]); //times:次數
        degree = Number(tempdata[sg][2]); //degree:幾度
        var hand = "R"; //hand:左右手 有成功?
        var level_ear = "S"; //level_ear:摸耳朵程度
        var is_Pebble_Connected = false; //測試Pebble是否連接
        var acc;
        var pebble_count = 0;
        var sony_connect = false;
        var sony_count = 0;
        var first_acc = 0;
        //-----------------開始載入手表插件
        watch_choice = tempdata[sg][4];
        if (watch_choice == 0) {
            loadBluetoothPlugin();
            var intInterval = setInterval(function() {
                window.plugins.BluetoothPlugin.passValue(function(data) {
                    pebble_count++;
                    acc = data.split("+", 3);
                    if (pebble_count == 1) {
                        first_acc = acc[2];
                    }
                    //alert(acc[2]);
                    if (acc[2] != undefined && acc[2] != first_acc) {
                        is_Pebble_Connected = true;
                    }
                }, function() {
                    alert("error");
                });
                if (pebble_count == 4) {
                    clearInterval(intInterval);
                    if (!is_Pebble_Connected) {
                        alert('手機尚未與手表連接，連接方法可參考PEBBLE使用手冊');
                        window.location.href = "w_index.html";
                    }
                }
            }, 250);
        } else if (watch_choice == 1) {
            watch_type = 1;
            loadSmartWatch2();
            var intInterval = setInterval(function() {
                window.plugins.GetValue.passValue(function(data) {
                    if (data != "not connect" && data != null)
                        sony_connect = true;
                }, function() {
                    alert("error");
                });
                if (sony_count == 4) {
                    clearInterval(intInterval);
                    if (!sony_connect) {
                        alert('手機尚未與手表連接，連接方法可參考SonySmartWatch使用手冊');
                        window.location.href = "w_index.html";
                    }
                }
                sony_count++;
            }, 250);

        } else if (watch_choice == 2) {
            watch_type = 1;
            loadBluetoothPlugin();
            window.plugins.PluginTest.buildSocket(function(data) {
                    if (data == 'Do not have paired device' || data == 'Can not find geak app') {
                        alert('手機尚未與手表連接，連接方法可參考GEAK連接手冊');
                        window.location.href = "w_index.html";
                    }
                },
                function(e) {
                    alert(e);
                });
        } else if (watch_choice == 3) {
            watch_type = 1;
            loadAndroidWear();
            window.plugins.AndroidWear.start(function(data) {
                    if (data == 'Watch one offline') {
                        alert('沒有手錶_1的連線，請確認有開啟藍芽並與Android Wear 連線');
                        window.location.href = "w_index.html";
                    }
                },
                function(e) {
                    alert(e);
                });
        }
        switch (action) {
            case 0: //上舉
                level_ear = 0; //無摸耳程度
                hand = 0; //無左右手
                type = 0;
                $(".img_action").attr('src', 'css/images/raise.png'); //change img of #ready_page
                $('.video_action').attr('src', 'video/raise_correct.mp4'); //change video of #ready_page
                $(".do_img").attr('src', 'css/images/raise_angle.png'); //change img of #do-page
                $(".action_h").html("上舉" + degree + "°"); //改變#ready_page動作類型
                $(".notice_p").html("※注意:請把聲音和藍芽開啟※</br>請把手錶戴在左手，錶面朝左");
                break;
            case 1: //下放
                degree = 0 //無角度
                level_ear = 0; //無摸耳程度
                hand = 0; //無左右手
                type = 1;
                $(".img_action").attr('src', "css/images/lower.png");
                $('.video_action').attr('src', 'video/lower_correct.mp4'); //change video of #ready_page
                $(".do_img").attr('src', 'css/images/lower.png'); //change img of #do-page
                $(".action_h").html("下放"); //改變#ready_page動作類型
                $(".notice_p").html("※注意:請把聲音和藍芽開啟※</br>請把手錶戴在左手，錶面朝左");
                break;
            case 2: //摸耳朵
                degree = 0 //無角度
                $(".img_action").attr('src', "css/images/ear.png");
                $('.video_action').attr('src', 'video/ear_correct.mp4'); //change video of #ready_page
                $(".do_img").attr('src', 'css/images/ear.png'); //change img of #do-page
                $(".action_h").html("摸耳朵:" + ((hand == 'L') ? "左手" : "右手") + ((level_ear == 'S') ? "到肩膀" : "到耳朵")); //改變#ready_page動作類型
                $(".notice_p").html("※注意:請把聲音和藍芽開啟※</br>請把手錶戴在左或右手，");
                if (level_ear == 'S') {
                    if (hand == 'R') { //右手肩膀
                        type = 2;
                    } else if (hand == 'L') { //左手肩膀
                        type = 3;
                    }
                } else if (level_ear == 'E') {
                    if (hand == 'R') { //右手耳朵
                        type = 4;
                    } else if (hand == 'L') { //左手耳朵
                        type = 5;
                    }
                }
                break;
            case 6: //踢腿
                degree = 0 //無角度
                level_ear = 0; //無摸耳程度
                hand = 0; //無左右手
                type = 6;
                $(".img_action").attr('src', "css/images/kick.png");
                $('.video_action').attr('src', 'video/raise_correct.mp4'); //change video of #ready_page
                $(".do_img").attr('src', 'css/images/kick.png'); //change img of #do-page
                $(".action_h").html("踢腿"); //改變#ready_page動作類型
                $(".notice_p").html("※注意:請把聲音和藍芽開啟※</br>手錶綁在腳的右側(如果你可以綁的話XD)");
                break;
            case 7: //挺腹
                degree = 0 //無角度
                level_ear = 0; //無摸耳程度
                hand = 0; //無左右手
                type = 7;
                $(".img_action").attr('src', "css/images/stomach.png");
                $('.video_action').attr('src', 'video/raise_correct.mp4'); //change video of #ready_page
                $(".do_img").attr('src', 'css/images/stomach.png'); //change img of #do-page
                $(".action_h").html("挺腹"); //改變#ready_page動作類型
                $(".notice_p").html("※注意:請把聲音和藍芽開啟※</br>請把手錶平貼於肚上，放在肚臍下方並把手錶朝自己、面朝上");
                break;
            case 8: //側抬腿
                degree = 0 //無角度
                level_ear = 0; //無摸耳程度
                hand = 0; //無左右手
                type = 8;
                $(".img_action").attr('src', "css/images/leg.png");
                $('.video_action').attr('src', 'video/raise_correct.mp4'); //change video of #ready_page
                $(".do_img").attr('src', 'css/images/leg.png'); //change img of #do-page
                $(".action_h").html("側抬腿"); //改變#ready_page動作類型
                $(".notice_p").html("※注意:請把聲音和藍芽開啟※</br>手錶綁在腳的右側(如果你可以綁的話XD)");
                break;
			case 10: //側上斜舉
                degree = 0 //無角度
                level_ear = 0; //無摸耳程度
                hand = 0; //無左右手
                type = 10;
                $(".img_action").attr('src', "css/images/arm_left.jpg");
                $('.video_action').attr('src', 'video/raise_correct.mp4'); //change video of #ready_page
                $(".do_img").attr('src', 'css/images/arm_left.jpg'); //change img of #do-page
                $(".action_h").html("側上斜舉"); //改變#ready_page動作類型
                $(".notice_p").html("※注意:請把聲音和藍芽開啟※");
                break;
			case 11: //手部內彎前伸
                degree = 0 //無角度
                level_ear = 0; //無摸耳程度
                hand = 0; //無左右手
                type = 11;
                $(".img_action").attr('src', "css/images/bend.png");
                $('.video_action').attr('src', 'video/bend_correct.mp4'); //change video of #ready_page
                $(".do_img").attr('src', 'css/images/bend.png'); //change img of #do-page
                $(".action_h").html("手部內彎前伸"); //改變#ready_page動作類型
                $(".notice_p").html("※注意:請把聲音和藍芽開啟※</br>兩隻手錶綁在左手和左臂");
                break;
        }
        //固定進入頁面先顯示圖片
        $('#picture_img').attr('src', 'css/ready/u39_selected.png');
        $('#video_img').attr('src', 'css/ready/u37.png');
        $('.video_action').css('display', 'none');
        $('.img_action').css('display', 'block');
        if (action != 9)
            $.mobile.changePage("#ready-page", null, true, true);
        else
        // Test
            $.mobile.changePage("#test-page", null, true, true);
        processlength = 100 / num;
        acce = 0; //一定要歸零!
        count = 0; //成功次數歸零
        error_count = 0; //失敗次數歸零
        f_count = 0;
        $('.f-times').html(f_count); //目前次數
        $('.t-times').html("/" + num + "次"); //總次數
        document.getElementById("times").innerHTML = "成功 0 次";
        document.getElementById("errortimes").innerHTML = "失敗 0 次";
    }
	
	function changeFunc($i){  //避免使用者選到不支援的選項 -by pig84
		var levelElement = document.getElementById("level-choice");
		var degreeElement = document.getElementById("degree-choice");
		var earElement = document.getElementById("ear-choice");
		var watchElement = document.getElementById("watch-choice");
		
		//remove options
		for (var index = levelElement.length-1 ; index >=1 ; index--){
			levelElement.remove(index);
		}
		for (var index = degreeElement.length-1 ; index >=1 ; index--){
			degreeElement.remove(index);
		}
		for (var index = earElement.length-1 ; index >=1 ; index--){
			earElement.remove(index);
		}
		for (var index = watchElement.length-1 ; index >=1 ; index--){
			watchElement.remove(index);
		}
		
		//init options
		//hand
		var optionLeft = document.createElement("option");
		optionLeft.value = "L";
		optionLeft.text = "左手";
		
		var optionRight = document.createElement("option");
		optionRight.value = "R";
		optionRight.text = "右手";
		
		var optionNone = document.createElement("option");
		optionNone.value = "Nope";
		optionNone.text = "無左右手";
		
		//degree
		var option_90 = document.createElement("option");
		option_90.value = "90";
		option_90.text = "90°";
		
		var option_120 = document.createElement("option");
		option_120.value = "120";
		option_120.text = "120°";
		
		var option_180 = document.createElement("option");
		option_180.value = "180";
		option_180.text = "180°";
		
		var option_no_degree = document.createElement("option");
		option_no_degree.value = "nope";
		option_no_degree.text = "無角度";
		
		//ear
		var optionShoulder = document.createElement("option");
		optionShoulder.value = "S";
		optionShoulder.text = "肩膀";
		
		var optionEar = document.createElement("option");
		optionEar.value = "E";
		optionEar.text = "耳朵";
		
		var optionNoEar = document.createElement("option");
		optionNoEar.value = "nope";
		optionNoEar.text = "無耳朵、肩膀選項";
		
		//watch
		var optionPebble = document.createElement("option");
		optionPebble.value = "0";
		optionPebble.text = "Pebble";
		var optionSmartWatch2 = document.createElement("option");
		optionSmartWatch2.value = "1";
		optionSmartWatch2.text = "SmartWatch2";
		var optionGeak = document.createElement("option");
		optionGeak.value = "2";
		optionGeak.text = "Geak";
		var optionAndroidWear = document.createElement("option");
		optionAndroidWear.value = "3";
		optionAndroidWear.text = "AndroidWear";
		 
		
		//adding options
		if ($i == 0 || $i == 1){ //上舉下放
			levelElement.add(optionLeft, levelElement[1]);
			earElement.add(optionNoEar, earElement[1]);
			watchElement.add(optionPebble,watchElement[1]);
			watchElement.add(optionSmartWatch2,watchElement[2]);
			watchElement.add(optionGeak,watchElement[3]);
			watchElement.add(optionAndroidWear,watchElement[4]);
			if($i == 0){
				degreeElement.add(option_90, degreeElement[1]);
				degreeElement.add(option_120, degreeElement[2]);
				degreeElement.add(option_180, degreeElement[3]);
			}
			else{
				degreeElement.add(option_no_degree, degreeElement[1]);
			}
		}
		else if ($i == 2){ //摸耳朵
			levelElement.add(optionRight, levelElement[1]);
			levelElement.add(optionLeft, levelElement[2]);
			degreeElement.add(option_no_degree, degreeElement[1]);
			earElement.add(optionShoulder,earElement[1]);
			earElement.add(optionEar,earElement[2]);
			watchElement.add(optionPebble,watchElement[1]);
			watchElement.add(optionSmartWatch2,watchElement[2]);
			watchElement.add(optionGeak,watchElement[3]);
			watchElement.add(optionAndroidWear,watchElement[4]);
		}
		else if ($i == 6){ //踢腿
			optionRight.text = "右腳";
			levelElement.add(optionRight, levelElement[1]);
			degreeElement.add(option_no_degree, degreeElement[1]);
			earElement.add(optionNoEar, earElement[1]);
			watchElement.add(optionPebble,watchElement[1]);
			watchElement.add(optionSmartWatch2,watchElement[2]);
			watchElement.add(optionGeak,watchElement[3]);
			watchElement.add(optionAndroidWear,watchElement[4]);
		}
		else if ($i == 7){ //挺腹
			levelElement.add(optionNone, levelElement[1]);
			degreeElement.add(option_no_degree, degreeElement[1]);
			earElement.add(optionNoEar, earElement[1]);
			watchElement.add(optionPebble,watchElement[1]);
			watchElement.add(optionSmartWatch2,watchElement[2]);
			watchElement.add(optionGeak,watchElement[3]);
			watchElement.add(optionAndroidWear,watchElement[4]);
		}
		else if ($i == 8){ //側抬腿
			optionRight.text = "右腳";
			levelElement.add(optionRight, levelElement[1]);
			degreeElement.add(option_no_degree, degreeElement[1]);
			earElement.add(optionNoEar, earElement[1]);
			watchElement.add(optionPebble,watchElement[1]);
			watchElement.add(optionSmartWatch2,watchElement[2]);
			watchElement.add(optionGeak,watchElement[3]);
			watchElement.add(optionAndroidWear,watchElement[4]);
		}
		else if ($i == 10){ //側上斜舉
			levelElement.add(optionLeft, levelElement[1]);
			degreeElement.add(option_no_degree, degreeElement[1]);
			earElement.add(optionNoEar, earElement[1]);
			watchElement.add(optionPebble,watchElement[1]);
			watchElement.add(optionSmartWatch2,watchElement[2]);
			watchElement.add(optionGeak,watchElement[3]);
			watchElement.add(optionAndroidWear,watchElement[4]);
		}
		else if ($i == 11){ //手部內彎前伸
			levelElement.add(optionLeft, levelElement[1]);
			degreeElement.add(option_no_degree, degreeElement[1]);
			earElement.add(optionNoEar, earElement[1]);
			watchElement.add(optionGeak,watchElement[1]);
			watchElement.add(optionAndroidWear,watchElement[2]);
		}
		else {
			alert('選項錯誤');
		}
	}

    function update() {
        var total = (count + error_count);
        $.ajax({
            url: "http://health.ncu.cc/isupload.php?command=watch_add",
            type: "POST",
            data: {
                data: "{\"id\":\"" + tempid + "\",\"date\":\"" + fd + "\",\"starttime\":\"" + Startime + "\",\"endtime\":\"" + ft + "\",\"action\":\"" + type + "\",\"angle\":\"" + degree + "\",\"suggest\":\"" + num + "\",\"success\":\"" + count + "\",\"fail\":\"" + error_count + "\",\"total\":\"" + total + "\",\"count\":\"" + id_count + "\"}"
            },
            dataType: "html",
            success: function(b) {
                alert("上傳成功!!");
            },
            fail: function(b) {
                alert("上傳失敗，請確認網路連線狀況。");
            }
        });
    }

    function uploadALL() {
            db.transaction(function(tx) {
                tx.executeSql('SELECT * FROM Score', [], function(tx, rs) {
                    $.each(rs.rows, function(index) {
                        var row = rs.rows.item(index);
                        if (row['date'] == null) {
                            //do nothing
                            //這是登入用name欄位(其他為null 所以不上傳)
                        } else {
                            $.ajax({
                                url: "http://health.ncu.cc/isupload.php?command=add",
                                type: "POST",
                                data: {
                                    data: "{\"id\":\"" + row['name'] + "\",\"date\":\"" + row['date'] + "\",\"starttime\":\"" + row['starttime'] + "\",\"endtime\":\"" + row['endtime'] + "\",\"action\":\"" + row['action'] + "\",\"angle\":\"" + row['angle'] + "\",\"suggest\":\"" + row['suggest'] + "\",\"success\":\"" + row['success'] + "\",\"fail\":\"" + row['fail'] + "\",\"total\":\"" + row['total'] + "\",\"count\":\"" + (row['id'] - 1) + "\"}"
                                },
                                dataType: "html",
                                success: function(b) {
                                    alert("上傳成功!!");
                                },
                                fail: function(b) {
                                    alert("Request failed: " + b);
                                }
                            });
                        }
                    });
                });
            });
        }
        //***************************mySQL*************************** 

    //create table 
    function populateDB(tx) {
        tx.executeSql('CREATE TABLE IF NOT EXISTS Score (id INTEGER PRIMARY KEY AUTOINCREMENT, name TEXT,date TEXT,starttime TEXT,endtime TEXT,action INTEGER,angle INTEGER,suggest INTEGER,success INTEGER,fail INTEGER,total INTEGER)');
    }

    //function will be called when an error occurred
    function errorCB(err) {
        alert("Error processing SQL: " + err.code);
    }

    //function will be called when process succeed and then show old record
    function successCB() {
        refresh();
    }

    //insert record into SoccerPlayer sql
    function insert(a, b, c, d, e, f, g, h, i, j) {
        db.transaction(
            function(tx) {
                tx.executeSql('INSERT INTO Score(name, date,starttime,endtime,action,angle,suggest,success,fail,total) VALUES (?,?,?,?,?,?,?,?,?,?)', [a, b, c, d, e, f, g, h, i, j]);
            },
            errorCB,
            function() {
                refresh();
            });
    }

    //ready to show data to record page
    function refresh() {
        db.transaction(queryDB, errorCB);
    }

    //select all data from SoccerPlayer
    function queryDB(tx) {
        tx.executeSql('SELECT * FROM Score', [], querySuccess, errorCB);
    }

    //fetch data one by one and put it to record page
    function querySuccess(tx, result) {
        var a = 1;
        var b;
        $('#SoccerPlayerList').empty();
        $.each(result.rows, function(index) {
            var row = result.rows.item(index);
            if (index == 0) {
                //不顯示只有name的欄位(第一次登入ID用)
            } else {
                if (a == 1) {
                    $('#SoccerPlayerList').append('<li class="track-date">' + row['date'] + '</li>');
                    a = 2;
                    b = row['date'];
                } else {
                    if (b != row['date']) {
                        $('#SoccerPlayerList').append('<li class="track-date">' + row['date'] + '</li>');
                    }
                    b = row['date'];
                }
                switch (row['action']) {
                    case 0:
                        reha_name = "上舉," + row['angle'] + "°";
                        break;
                    case 1:
                        reha_name = "下放";
                        break;
                    case 2:
                        reha_name = "右手摸耳,到肩膀";
                        break;
                    case 3:
                        reha_name = "左手摸耳,到肩膀";
                        break;
                    case 4:
                        reha_name = "右手摸耳";
                        break;
                    case 5:
                        reha_name = "左手摸耳";
                        break;
                    case 6:
                        reha_name = "踢腿";
                        break;
                    case 7:
                        reha_name = "挺腹";
                        break;
                    case 8:
                        reha_name = "側抬腿";
                        break;
					case 10:
                        reha_name = "側上斜舉";
                        break;
					case 11:
						reha_name = "手部內彎前伸";
						break;
                }
                $('#SoccerPlayerList').append('<li class="track-detail"><label class="track-1">' + row['starttime'] + '</label><label class="track-2">' + reha_name + '</label><label class="track-3">' + row['suggest'] + ' times</label></li>');
            }
        });
    }

    function addUserID() {
        tempid = document.getElementById('text_id').value;
        if (tempid.length != 7) {
            alert("請再次確認，並重新輸入");
            return false;
        }
        db.transaction(
            function(tx) {
                tx.executeSql('INSERT INTO Score (name) VALUES (?)', [tempid]);
                id_count = 0;
            },
            errorCB,
            function() {
                refresh();
            });
        userId = tempid;
        $.mobile.changePage("#main-page", null, true, true);
    }


    function hasID() {
            db.transaction(function(tx) {
                tx.executeSql('SELECT * FROM Score', [], function(tx, rs) {
                    for (var i = 0; i < rs.rows.length; i++) {
                        if (rs.rows.item(i)['name'] != null) {
                            tempid = rs.rows.item(i)['name'];
                            id_count = (rs.rows.length - 1); //找到目前的database index                          
                            //alert('Hi '+rs.rows.item(i)['name']);
                            userId = rs.rows.item(i)['name'];
                            $.mobile.changePage("#main-page", null, true, true);
                            return;
                        }
                    }
                    alert("第一次登入，請輸入ID。");
                });
            });
        }
        /*檢查是否有連接到pebble*/
    function checkConnectPebble() {
        //window.plugins.BluetoothPlugin.passValue(onSuccess_W,onError);
        if (xyz == 123) {
            $('.bluetooth_img').attr('src', 'css/images/Icon_Watch_Down.png');
            lock = false;
        } else {
            $('.bluetooth_img').attr('src', 'css/images/Icon_Watch_Normal.png');
            alert("請確認是否有正確的與手錶連結");
            lock = true;
        }
    }

    function getStartime() {
            var Stime = new Date(); ///開始時間
            Shour = Stime.getHours();
            Sminute = Stime.getMinutes();
            Ssecond = Stime.getSeconds();
            if (Shour < 10) {
                Shour = "0" + Shour;
            }
            if (Sminute < 10) {
                Sminute = "0" + Sminute;
            }
            if (Ssecond < 10) {
                Ssecond = "0" + Ssecond;
            }
            Startime = Shour + ":" + Sminute + ":" + Ssecond;
        }
        /*-----做出錯誤動作時的反應!!!------*/
    function interupt() {
        //playmusic(6);           /*-----動作錯誤，請從新開始 error.mp3-----*/
        e_media.play();
        e_media.seekTo(0);
        ready = 0;
        acce = 0; //1s後在開始
        test = 0; //做到哪
        error_count++;
        $('.f-times').html(++f_count); //目前次數
        //setProcess(f_count);  
        document.getElementById("errortimes").innerHTML = "失敗 " + error_count + " 次";
    }

    function onError() {
        alert("錯誤:加速感測器發生錯誤!");
    }

    function onError_smartWatch2() {
        alert("發生錯誤_smartWatch2!");
    }

    function onError_gball() {
        alert("發生錯誤_gball!");
    }

    /*-------------------手錶------------------*/
    function start_action() {
        $('.d').removeClass('ui-btn-active');
        alert("復健即將開始，請準備就定位！");
        getStartime();
        acce = 0;
        count = 0;
        error_count = 0;
        test = 0;
        f_count = 0;
        /////用手錶的sensor
        if (watch_choice == 0) {

            pe_frequency = setInterval(function() { //每400ms call passValue，pebble便會傳值到手機
                ///開始傳值 500ms傳一次
                window.plugins.BluetoothPlugin.passValue(onSuccess_W, onError);
            }, 400);

        } else if (watch_choice == 1) {
            pe_frequency = setInterval(function() { //每400ms call passValue，pebble便會傳值到手機
                ///開始傳值 500ms傳一次
                window.plugins.GetValue.passValue(onSuccess_W, onError);
            }, 250);
        } else if (watch_choice == 2) {

            // window.plugins.PluginTest.buildSocket(function (data){
            //  alert(data);
            // }
            // , function(e){
            //  alert(e);
            // });
            pe_frequency = setInterval(function() { //每400ms call passValue，pebble便會傳值到手機
                ///開始傳值 500ms傳一次
                window.plugins.PluginTest.getAcceleration(onSuccess_W, onError);
            }, 100);
        } else if (watch_choice == 3) {
            pe_frequency = setInterval(function() { //每100ms call passValue，AndroidWear便會傳值到手機
                ///開始傳值 500ms傳一次
                window.plugins.AndroidWear.start(onSuccess_W, onError);
            }, 100);
        }
        // pe_frequency = setInterval(function(){  //每400ms call passValue，pebble便會傳值到手機
        //              ///開始傳值 500ms傳一次
        //              window.plugins.GetValue.passValue(onSuccess_W,onError);
        // },100);
        /////用手錶的sensor
        // pe_frequency = setInterval(function(){  //每400ms call passValue，pebble便會傳值到手機
        //          ///開始傳值 500ms傳一次
        //         window.plugins.BluetoothPlugin.passValue(onSuccess_W,onError);
        //       },$("#rate-choice").val());
        loopback();
        setTimeout(function() { //1秒後播請就定位音樂
            r_media.play();
            r_media.seekTo(0);
        }, 1000);
        //readyAlert("請就定位",3000);     //3秒後關閉alert
    }

    //function onSuccess_smartWatch2(r) {
    // if (r == "not connect") {
    //     alert("尚未與SmartWatch2連接，連接方法請參考SmartWatch2連接手冊");
    //     window.location.href = "w_index.html";
    // }
    //}

    function onSuccess_gball(r) {
        alert(r);
        // String ss = r;
        // alert(ss);
    }

    function onSuccess_W(r) {
        xyz = r.split("+", 6);

		//alert(xyz[0]+xyz[1]+xyz[2]+xyz[3]+xyz[4]+xyz[5]);

		
        //alert(xyz[0]);
        /*document.getElementById('accelerometer').innerHTML = 'X:' + xyz[0] + tab +
                                                            'Y:' + xyz[1] + tab +
                                                            'Z:' + xyz[2] ;*/
        acce++;

        if (watch_type == 0) {
            if (acce > 4) { //1s定位

                switch (type) {
                    //-------------上舉 
                    case 0:
                        if (test == 0) {
                            if (type1_start_lowerbound_x < Math.abs(xyz[0]) && Math.abs(xyz[0]) < type1_start_upperbound_x && type1_start_lowerbound_y < xyz[1] && xyz[1] < type1_start_upperbound_y) {
                                //判斷開始動作
                                s_media.play(); //開始音效
                                s_media.seekTo(0);
                                test = 1;
                            }
                        } 
						else if (test == 1) {
							/*
                            if (type1_fail_lowerbound_y < xyz[1] || type1_fail_lowerbound_z < xyz[2] || xyz[2] < type1_fail_upperbound_z) {
                                失敗(錯誤動作)   
                                interupt();
                                if ((count + error_count) == num) {
                                    stopPebble();
                                }
                            } */
							if (xyz[0] < type1_90_success_upperbound_x && type1_90_success_lowerbound_y < xyz[1] && xyz[1] < type1_90_success_upperbound_y) {
                                if (degree == 90) { //上舉90度成功
                                    test = 0;
                                    count++;
                                    document.getElementById("times").innerHTML = "成功 " + count + " 次";
                                    $('.f-times').html(++f_count); //目前次數 
                                    //setProcess(f_count); 
                                    acce = 0;
                                    if ((count + error_count) == num) {
                                        //alert("success");
                                        stopPebble();
                                        //恭喜，已達成目標
                                        navigator.notification.vibrate(1000);
                                        f_media.play();
                                        f_media.seekTo(0);
                                    } else {
                                        //完成，請再次就定位
                                        navigator.notification.vibrate(500);
                                        a_media.play();
                                        a_media.seekTo(0);
                                    }
                                } 
								else {
                                    //120 180度 經過90度的回饋震動
                                    navigator.notification.vibrate(500);
                                    test = 2;
                                }

                            }
                        } 
						else if (test == 2) {
                            if (type1_fail_lowerbound_y < xyz[1] || type1_fail_lowerbound_z < xyz[2] || xyz[2] < type1_fail_upperbound_z) {
                                //失敗(錯誤動作)            
                                //interupt();
                                //if ((count + error_count) == num) {
                                //    stopPebble();
                                //}
                            }
                            if (type1_120_success_lowerbound_x < xyz[0] && xyz[0] < type1_120_success_upperbound_x && type1_120_success_lowerbound_y < xyz[1] && xyz[1] < type1_120_success_upperbound_y) {
                                if (degree == 120) { //上舉120度成功
                                    test = 0;
                                    count++;
                                    document.getElementById("times").innerHTML = "成功 " + count + " 次";
                                    $('.f-times').html(++f_count); //目前次數 
                                    //setProcess(f_count); 
                                    acce = 0;
                                    if ((count + error_count) == num) {
                                        stopPebble();
                                        //恭喜，已達成目標  
                                        navigator.notification.vibrate(500);
                                        f_media.play();
                                        f_media.seekTo(0);
                                    } else {
                                        //已完成，請再次就定位
                                        navigator.notification.vibrate(500);
                                        a_media.play();
                                        a_media.seekTo(0);
                                    }
                                } 
								else {
                                    //180度 經過120度的回饋震動
                                    navigator.notification.vibrate(500);
                                    test = 3;
                                }

                            }
                        } 
						else if (test == 3){ //上舉180度
                            if (type1_fail_lowerbound_y < xyz[1] || type1_fail_lowerbound_z < xyz[2] || xyz[2] < type1_fail_upperbound_z) {
                                //失敗(錯誤動作)      
                                //interupt();
                                //if ((count + error_count) == num) {
                                //    stopPebble();
                                //}
                            }
                            if (type1_180_success_lowerbound_x < xyz[0] && xyz[0] < type1_180_success_upperbound_x && Math.abs(xyz[1]) < type1_180_success_upperbound_y) {
                                //180度成功
                                test = 0;
                                count++;
                                document.getElementById("times").innerHTML = "成功 " + count + " 次";
                                $('.f-times').html(++f_count); //目前次數  
                                //setProcess(f_count);
                                acce = 0;
                                if ((count + error_count) == num) {
                                    stopPebble();
                                    //恭喜，已達成目標
                                    navigator.notification.vibrate(1000);
                                    f_media.play();
                                    f_media.seekTo(0);
                                } else {
                                    //已完成，請再次就定位
                                    navigator.notification.vibrate(1000);
                                    a_media.play();
                                    a_media.seekTo(0);
                                }

                            }
                        }
						
						else if (test == 4){
						}
                        break;

                    case 1: //下放 

                        if (test == 0) {
                            if (type2_start_lowerbound_x < Math.abs(xyz[0]) && Math.abs(xyz[0]) < type2_start_upperbound_x && type2_start_lowerbound_y < xyz[1] && xyz[1] < type2_start_upperbound_y) {
                                //判斷開始動作
                                s_media.play();
                                s_media.seekTo(0);
                                test = 1;
                            }
                        } else {
                            /*if(6 < Math.abs(xyz[2])){    
                              //失敗(錯誤動作)             
                                interupt();
                              }    */
                            if (type2_success_lowerbound_x < xyz[0] && xyz[1] < type2_success_upperbound_y) {
                                //下放成功
                                test = 0;
                                count++;
                                document.getElementById("times").innerHTML = "成功 " + count + " 次";
                                $('.f-times').html(++f_count); //目前次數  
                                //setProcess(f_count);
                                acce = 0;
                                if ((count + error_count) == num) {
                                    stopPebble();
                                    navigator.notification.vibrate(1000);
                                    f_media.play();
                                    f_media.seekTo(0);
                                } else {
                                    navigator.notification.vibrate(1000);
                                    a_media.play();
                                    a_media.seekTo(0);
                                }
                            }
                        }
                        break;

                    case 2: //摸耳右手 lv2

                        if (test == 0) {
                            if (type35_start_lowerbound_x < xyz[0] && xyz[0] < type35_start_upperbound_x && type35_start_lowerbound_y < xyz[1] && xyz[1] < type35_start_upperbound_y && type35_start_lowerbound_z < xyz[2] && xyz[2] < type35_start_upperbound_z) {
                                //判斷開始動作
                                s_media.play();
                                s_media.seekTo(0);
                                test = 1;
                            }
                        } else {
                            if (type3_success_lowerbound_x < xyz[0] && xyz[0] < type3_success_upperbound_x &&
                                type3_success_lowerbound_y < xyz[1] && xyz[1] < type3_success_upperbound_y &&
                                type3_success_lowerbound_z < xyz[2] && xyz[2] < type3_success_upperbound_z) {
                                test = 0;
                                count++;
                                document.getElementById("times").innerHTML = "成功 " + count + " 次";
                                $('.f-times').html(++f_count); //目前次數  
                                //setProcess(f_count);
                                acce = 0;
                                if ((count + error_count) == num) {
                                    stopPebble();
                                    //恭喜，已達成目標
                                    navigator.notification.vibrate(1000);
                                    f_media.play();
                                    f_media.seekTo(0);
                                } else {
                                    //已完成，請再次就定位
                                    navigator.notification.vibrate(1000);
                                    a_media.play();
                                    a_media.seekTo(0);
                                }
                            }
                        }
                        break;

                    case 3: //摸耳左手lv2

                        if (test == 0) {
                            if (type46_start_lowerbound_x < xyz[0] && xyz[0] < type46_start_upperbound_x && type46_start_lowerbound_y < xyz[1] && xyz[1] < type46_start_upperbound_y && type46_start_lowerbound_z < xyz[2] && xyz[2] < type46_start_upperbound_z) {
                                //判斷開始動作
                                s_media.play();
                                s_media.seekTo(0);
                                test = 1;
                            }
                        } else {

                            if (type4_success_lowerbound_x < xyz[0] && xyz[0] < type4_success_upperbound_x && type4_success_lowerbound_y < xyz[1] && xyz[1] < type4_success_upperbound_y && type4_success_lowerbound_z < xyz[2] && xyz[2] < type4_success_upperbound_z) {
                                test = 0;
                                count++;
                                document.getElementById("times").innerHTML = "成功 " + count + " 次";
                                $('.f-times').html(++f_count); //目前次數 
                                //setProcess(f_count);
                                acce = 0;
                                if ((count + error_count) == num) {
                                    stopPebble();
                                    //恭喜，已達成目標
                                    navigator.notification.vibrate(1000);
                                    f_media.play();
                                    f_media.seekTo(0);
                                } else {
                                    //已完成，請再次就定位
                                    navigator.notification.vibrate(1000);
                                    a_media.play();
                                    a_media.seekTo(0);
                                }
                            }
                        }
                        break;

                    case 4: //摸耳右手 lv3

                        if (test == 0) {
                            if (type35_start_lowerbound_x < xyz[0] && xyz[0] < type35_start_upperbound_x && type35_start_lowerbound_y < xyz[1] && xyz[1] < type35_start_upperbound_y && type35_start_lowerbound_z < xyz[2] && xyz[2] < type35_start_upperbound_z) {
                                //判斷開始動作
                                s_media.play();
                                s_media.seekTo(0);
                                test = 1;
                            }
                        } else {
                            /*if(xyz[2]<-900){     
                              //失敗(錯誤動作)            
                                interupt();
                                if((count+error_count)==num){
                                      stopPebble();    
                                    }
                              } */
                            if (type5_success_lowerbound_x < xyz[0] && xyz[0] < type5_success_upperbound_x && type5_success_lowerbound_y < xyz[1] && xyz[1] < type5_success_upperbound_y && type5_success_lowerbound_z < xyz[2] && xyz[2] < type5_success_upperbound_z) {
                                test = 0;
                                count++;
                                document.getElementById("times").innerHTML = "成功 " + count + " 次";
                                $('.f-times').html(++f_count); //目前次數  
                                //setProcess(f_count);
                                acce = 0;
                                if ((count + error_count) == num) {
                                    stopPebble();
                                    //恭喜，已達成目標
                                    navigator.notification.vibrate(1000);
                                    f_media.play();
                                    f_media.seekTo(0);
                                } else {
                                    //已完成，請再次就定位
                                    navigator.notification.vibrate(1000);
                                    a_media.play();
                                    a_media.seekTo(0);
                                }
                            }
                        }
                        break;
                    case 5: //摸耳左手lv3

                        if (test == 0) {
                            if (type46_start_lowerbound_x < xyz[0] && xyz[0] < type46_start_upperbound_x && type46_start_lowerbound_y < xyz[1] && xyz[1] < type46_start_upperbound_y && type46_start_lowerbound_z < xyz[2] && xyz[2] < type46_start_upperbound_z) {
                                //開始位置
                                s_media.play();
                                s_media.seekTo(0);
                                test = 1;
                            }
                        } else {

                            if (type6_success_lowerbound_x < xyz[0] && xyz[0] < type6_success_upperbound_x && type6_success_lowerbound_y < xyz[1] && xyz[1] < type6_success_upperbound_y && type6_success_lowerbound_z < xyz[2] && xyz[2] < type6_success_upperbound_z) {
                                test = 0;
                                count++;

                                document.getElementById("times").innerHTML = "成功 " + count + " 次";
                                $('.f-times').html(++f_count); //目前次數  
                                //setProcess(f_count);
                                acce = 0;
                                if ((count + error_count) == num) {
                                    stopPebble();
                                    //恭喜，已達成目標
                                    navigator.notification.vibrate(1000);
                                    f_media.play();
                                    f_media.seekTo(0);
                                } else {
                                    //已完成，請再次就定位
                                    navigator.notification.vibrate(1000);
                                    a_media.play();
                                    a_media.seekTo(0);
                                }
                            }
                        }
                        break;

                    case 6: //踢腿
                        if (test == 0) {
                            if (type7_start_lowerbound_x < xyz[0] && xyz[0] < type7_start_upperbound_x && type7_start_lowerbound_y < xyz[1] && xyz[1] < type7_start_upperbound_y) {
                                //判斷開始動作
                                s_media.play();
                                s_media.seekTo(0);
                                test = 1;
                            }
                        } else {
                            if (xyz[2] > type7_fail_lowerbound_z || xyz[2] < type7_fail_upperbound_z) {
                                //失敗(錯誤動作)               
                                interupt();
                                if ((count + error_count) == num) {
                                    stopPebble();
                                }
                            }
                            if (type7_success_lowerbound_x < xyz[0] && xyz[0] < type7_success_upperbound_x && type7_success_lowerbound_y < xyz[1] && xyz[1] < type7_success_upperbound_y) {
                                test = 0;
                                count++;
                                document.getElementById("times").innerHTML = "成功 " + count + " 次";
                                $('.f-times').html(++f_count); //目前次數 
                                //setProcess(f_count);
                                acce = 0;
                                if ((count + error_count) == num) {
                                    //恭喜，已達成目標
                                    stopPebble();
                                    navigator.notification.vibrate(1000);
                                    f_media.play();
                                    f_media.seekTo(0);
                                } else {
                                    //已完成，請再次就定位
                                    navigator.notification.vibrate(1000);
                                    a_media.play();
                                    a_media.seekTo(0);
                                }
                            }
                        }
                        break;

                    case 7: //挺腹
                        if (test == 0) {
                            if (type8_start_lowerbound_x < xyz[0] && xyz[0] < type8_start_upperbound_x && type8_start_lowerbound_y < xyz[1] && xyz[1] < type8_start_upperbound_y) {
                                //判斷開始動作
                                s_media.play();
                                s_media.seekTo(0);
                                test = 1;
                            }
                        } else {
                            if (type8_success_lowerbound_x < xyz[0] && xyz[0] < type8_success_upperbound_x && type8_success_lowerbound_y < xyz[1] && xyz[1] < type8_success_upperbound_y) {
                                test = 0;
                                count++;
                                document.getElementById("times").innerHTML = "成功 " + count + " 次";
                                $('.f-times').html(++f_count); //目前次數 
                                //setProcess(f_count);
                                acce = 0;
                                if ((count + error_count) == num) {
                                    //恭喜，已達成目標
                                    stopPebble();
                                    navigator.notification.vibrate(1000);
                                    f_media.play();
                                    f_media.seekTo(0);
                                } else {
                                    //已完成，請再次就定位
                                    navigator.notification.vibrate(1000);
                                    a_media.play();
                                    a_media.seekTo(0);
                                }
                            }
                        }
                        break;

                    case 8: //側抬腳
                        if (test == 0) {
                            if (type9_start_lowerbound_x < xyz[0] && xyz[0] < type9_start_upperbound_x && type9_start_lowerbound_y < xyz[1] && xyz[1] < type9_start_upperbound_y && type9_start_lowerbound_z < xyz[2] && xyz[2] < type9_start_upperbound_z) {
                                //判斷開始動作
                                s_media.play();
                                s_media.seekTo(0);
                                test = 1;
                            }
                        } else {
                            if (type9_success_lowerbound_x < xyz[0] && xyz[0] < type9_success_upperbound_x && type9_success_lowerbound_y < xyz[1] && xyz[1] < type9_success_upperbound_y && type9_success_lowerbound_z < Math.abs(xyz[2]) && Math.abs(xyz[2]) < type9_success_upperbound_z) {
                                test = 0;
                                count++;
                                document.getElementById("times").innerHTML = "成功 " + count + " 次";
                                $('.f-times').html(++f_count); //目前次數 
                                //setProcess(f_count);
                                acce = 0;
                                if ((count + error_count) == num) {
                                    //恭喜，已達成目標
                                    stopPebble();
                                    navigator.notification.vibrate(1000);
                                    f_media.play();
                                    f_media.seekTo(0);
                                } else {
                                    //已完成，請再次就定位
                                    navigator.notification.vibrate(1000);
                                    a_media.play();
                                    a_media.seekTo(0);
                                }
                            }
                            if (xyz[1] > type9_fail_lowerbound_y || xyz[1] < type9_fail_upperbound_y) {
                                //失敗(錯誤動作)     
                                interupt();
                                if ((count + error_count) == num) {
                                    stopPebble();
                                }
                            }
                        }
                        break;
                } /*--switch--*/
            } /*--acce--*/
            //--------------------------------開始watch1--------------------------------------------------------------
        } else if (watch_type == 1) {
            //alert(acce);
            if (acce > 4) { //1s定位
                switch (type) {
                    //-------------上舉 
                    case 0:
                        if (test == 0) {
                            if (watch1_type1_start_lowerbound_x < Math.abs(xyz[0]) && Math.abs(xyz[0]) < watch1_type1_start_upperbound_x && watch1_type1_start_lowerbound_y < xyz[1] && xyz[1] < watch1_type1_start_upperbound_y) {
                                //判斷開始動作
                                s_media.play(); //開始音效
                                s_media.seekTo(0);
                                test = 1;
                            }
                        } else if (test == 1) {
                            if (watch1_type1_fail_lowerbound_y < xyz[1] || watch1_type1_fail_lowerbound_z < xyz[2] || xyz[2] < watch1_type1_fail_upperbound_z) {
                                //失敗(錯誤動作)   
                                interupt();
                                if ((count + error_count) == num) {
                                    stopPebble();
                                }
                            } else if (xyz[0] < watch1_type1_90_success_upperbound_x && watch1_type1_90_success_lowerbound_y < xyz[1] && xyz[1] < watch1_type1_90_success_upperbound_y) {
                                if (degree == 90) { //上舉90度成功
                                    test = 0;
                                    count++;
                                    document.getElementById("times").innerHTML = "成功 " + count + " 次";
                                    $('.f-times').html(++f_count); //目前次數 
                                    //setProcess(f_count); 
                                    acce = 0;
                                    if ((count + error_count) == num) {
                                        //alert("success");
                                        stopPebble();
                                        //恭喜，已達成目標
                                        navigator.notification.vibrate(1000);
                                        f_media.play();
                                        f_media.seekTo(0);
                                    } else {
                                        //完成，請再次就定位
                                        navigator.notification.vibrate(500);
                                        a_media.play();
                                        a_media.seekTo(0);
                                    }
                                } else {
                                    //120 180度 經過90度的回饋震動
                                    navigator.notification.vibrate(500);
                                    test = 2;
                                }

                            }
                        } else if (test == 2) {
                            if (watch1_type1_fail_lowerbound_y < xyz[1] || watch1_type1_fail_lowerbound_z < xyz[2] || xyz[2] < watch1_type1_fail_upperbound_z) {
                                //失敗(錯誤動作)            
                                interupt();
                                if ((count + error_count) == num) {
                                    stopPebble();
                                }
                            }
                            if (watch1_type1_120_success_lowerbound_x < xyz[0] && xyz[0] < watch1_type1_120_success_upperbound_x && watch1_type1_120_success_lowerbound_y < xyz[1] && xyz[1] < watch1_type1_120_success_upperbound_y) {
                                if (degree == 120) { //上舉120度成功
                                    test = 0;
                                    count++;
                                    document.getElementById("times").innerHTML = "成功 " + count + " 次";
                                    $('.f-times').html(++f_count); //目前次數 
                                    //setProcess(f_count); 
                                    acce = 0;
                                    if ((count + error_count) == num) {
                                        stopPebble();
                                        //恭喜，已達成目標  
                                        navigator.notification.vibrate(500);
                                        f_media.play();
                                        f_media.seekTo(0);
                                    } else {
                                        //已完成，請再次就定位
                                        navigator.notification.vibrate(500);
                                        a_media.play();
                                        a_media.seekTo(0);
                                    }
                                } else {
                                    //180度 經過90度的回饋震動
                                    navigator.notification.vibrate(500);
                                    test = 3;
                                }

                            }
                        } else { //上舉180度
                            if (watch1_type1_fail_lowerbound_y < xyz[1] || watch1_type1_fail_lowerbound_z < xyz[2] || xyz[2] < watch1_type1_fail_upperbound_z) {
                                //失敗(錯誤動作)      
                                interupt();
                                if ((count + error_count) == num) {
                                    stopPebble();
                                }
                            }
                            if (watch1_type1_180_success_lowerbound_x < xyz[0] && xyz[0] < watch1_type1_180_success_upperbound_x && Math.abs(xyz[1]) < watch1_type1_180_success_upperbound_y) {
                                //180度成功
                                test = 0;
                                count++;
                                document.getElementById("times").innerHTML = "成功 " + count + " 次";
                                $('.f-times').html(++f_count); //目前次數  
                                //setProcess(f_count);
                                acce = 0;
                                if ((count + error_count) == num) {
                                    stopPebble();
                                    //恭喜，已達成目標
                                    navigator.notification.vibrate(1000);
                                    f_media.play();
                                    f_media.seekTo(0);
                                } else {
                                    //已完成，請再次就定位
                                    navigator.notification.vibrate(1000);
                                    a_media.play();
                                    a_media.seekTo(0);
                                }

                            }
                        }
                        break;

                    case 1: //下放 

                        if (test == 0) {
                            if (watch1_type2_start_lowerbound_x < Math.abs(xyz[0]) && Math.abs(xyz[0]) < watch1_type2_start_upperbound_x && watch1_type2_start_lowerbound_y < xyz[1] && xyz[1] < watch1_type2_start_upperbound_y) {
                                //判斷開始動作
                                s_media.play();
                                s_media.seekTo(0);
                                test = 1;
                            }
                        } else {

                            if (watch1_type2_success_lowerbound_x < xyz[0] && xyz[1] < watch1_type2_success_upperbound_y) {
                                //下放成功
                                test = 0;
                                count++;
                                document.getElementById("times").innerHTML = "成功 " + count + " 次";
                                $('.f-times').html(++f_count); //目前次數  
                                //setProcess(f_count);
                                acce = 0;
                                if ((count + error_count) == num) {
                                    stopPebble();
                                    navigator.notification.vibrate(1000);
                                    f_media.play();
                                    f_media.seekTo(0);
                                } else {
                                    navigator.notification.vibrate(1000);
                                    a_media.play();
                                    a_media.seekTo(0);
                                }
                            }
                        }
                        break;

                    case 2: //摸耳右手 lv2

                        if (test == 0) {
                            if (watch1_type35_start_lowerbound_x < xyz[0] && xyz[0] < watch1_type35_start_upperbound_x && watch1_type35_start_lowerbound_y < xyz[1] && xyz[1] < watch1_type35_start_upperbound_y && watch1_type35_start_lowerbound_z < xyz[2] && xyz[2] < watch1_type35_start_upperbound_z) {
                                //判斷開始動作
                                s_media.play();
                                s_media.seekTo(0);
                                test = 1;
                            }
                        } else {
                            /*if(xyz[2]<-900){     
                              //失敗(錯誤動作)            
                                interupt();
                                if((count+error_count)==num){
                                      stopPebble();    
                                    }
                              } */
                            if (watch1_type3_success_lowerbound_x < xyz[0] && xyz[0] < watch1_type3_success_upperbound_x &&
                                watch1_type3_success_lowerbound_y < xyz[1] && xyz[1] < watch1_type3_success_upperbound_y &&
                                watch1_type3_success_lowerbound_z < xyz[2] && xyz[2] < watch1_type3_success_upperbound_z) {
                                test = 0;
                                count++;
                                document.getElementById("times").innerHTML = "成功 " + count + " 次";
                                $('.f-times').html(++f_count); //目前次數  
                                //setProcess(f_count);
                                acce = 0;
                                if ((count + error_count) == num) {
                                    stopPebble();
                                    //恭喜，已達成目標
                                    navigator.notification.vibrate(1000);
                                    f_media.play();
                                    f_media.seekTo(0);
                                } else {
                                    //已完成，請再次就定位
                                    navigator.notification.vibrate(1000);
                                    a_media.play();
                                    a_media.seekTo(0);
                                }
                            }
                        }
                        break;

                    case 3: //摸耳左手lv2

                        if (test == 0) {
                            if (watch1_type46_start_lowerbound_x < xyz[0] && xyz[0] < watch1_type46_start_upperbound_x && watch1_type46_start_lowerbound_y < xyz[1] && xyz[1] < watch1_type46_start_upperbound_y && watch1_type46_start_lowerbound_z < xyz[2] && xyz[2] < watch1_type46_start_upperbound_z) {
                                //判斷開始動作
                                s_media.play();
                                s_media.seekTo(0);
                                test = 1;
                            }
                        } else {
                            /*if(xyz[2]<-900){    
                            //失敗(錯誤動作)             
                                interupt();
                                if((count+error_count)==num){
                                      stopPebble();    
                                    }
                              }   */
                            if (watch1_type4_success_lowerbound_x < xyz[0] && xyz[0] < watch1_type4_success_upperbound_x && watch1_type4_success_lowerbound_y < xyz[1] && xyz[1] < watch1_type4_success_upperbound_y && watch1_type4_success_lowerbound_z < xyz[2] && xyz[2] < watch1_type4_success_upperbound_z) {
                                test = 0;
                                count++;
                                document.getElementById("times").innerHTML = "成功 " + count + " 次";
                                $('.f-times').html(++f_count); //目前次數 
                                //setProcess(f_count);
                                acce = 0;
                                if ((count + error_count) == num) {
                                    stopPebble();
                                    //恭喜，已達成目標
                                    navigator.notification.vibrate(1000);
                                    f_media.play();
                                    f_media.seekTo(0);
                                } else {
                                    //已完成，請再次就定位
                                    navigator.notification.vibrate(1000);
                                    a_media.play();
                                    a_media.seekTo(0);
                                }
                            }
                        }
                        break;

                    case 4: //摸耳右手 lv3

                        if (test == 0) {
                            if (watch1_type35_start_lowerbound_x < xyz[0] && xyz[0] < watch1_type35_start_upperbound_x && watch1_type35_start_lowerbound_y < xyz[1] && xyz[1] < watch1_type35_start_upperbound_y && watch1_type35_start_lowerbound_z < xyz[2] && xyz[2] < watch1_type35_start_upperbound_z) {
                                //判斷開始動作
                                s_media.play();
                                s_media.seekTo(0);
                                test = 1;
                            }
                        } else {
                            /*if(xyz[2]<-900){     
                              //失敗(錯誤動作)            
                                interupt();
                                if((count+error_count)==num){
                                      stopPebble();    
                                    }
                              } */
                            if (watch1_type5_success_lowerbound_x < xyz[0] && xyz[0] < watch1_type5_success_upperbound_x && watch1_type5_success_lowerbound_y < xyz[1] && xyz[1] < watch1_type5_success_upperbound_y && watch1_type5_success_lowerbound_z < xyz[2] && xyz[2] < watch1_type5_success_upperbound_z) {
                                test = 0;
                                count++;
                                document.getElementById("times").innerHTML = "成功 " + count + " 次";
                                $('.f-times').html(++f_count); //目前次數  
                                //setProcess(f_count);
                                acce = 0;
                                if ((count + error_count) == num) {
                                    stopPebble();
                                    //恭喜，已達成目標
                                    navigator.notification.vibrate(1000);
                                    f_media.play();
                                    f_media.seekTo(0);
                                } else {
                                    //已完成，請再次就定位
                                    navigator.notification.vibrate(1000);
                                    a_media.play();
                                    a_media.seekTo(0);
                                }
                            }
                        }
                        break;
                    case 5: //摸耳左手lv3

                        if (test == 0) {
                            if (watch1_type46_start_lowerbound_x < xyz[0] && xyz[0] < watch1_type46_start_upperbound_x && watch1_type46_start_lowerbound_y < xyz[1] && xyz[1] < watch1_type46_start_upperbound_y && watch1_type46_start_lowerbound_z < xyz[2] && xyz[2] < watch1_type46_start_upperbound_z) {
                                //開始位置
                                s_media.play();
                                s_media.seekTo(0);
                                test = 1;
                            }
                        } else {
                            /*if(xyz[2]<-900){  
                               //判斷開始動作              
                                interupt();
                                if((count+error_count)==num){
                                      stopPebble();    
                                }
                              } */
                            if (watch1_type6_success_lowerbound_x < xyz[0] && xyz[0] < watch1_type6_success_upperbound_x && watch1_type6_success_lowerbound_y < xyz[1] && xyz[1] < watch1_type6_success_upperbound_y && watch1_type6_success_lowerbound_z < xyz[2] && xyz[2] < watch1_type6_success_upperbound_z) {
                                test = 0;
                                count++;

                                document.getElementById("times").innerHTML = "成功 " + count + " 次";
                                $('.f-times').html(++f_count); //目前次數  
                                //setProcess(f_count);
                                acce = 0;
                                if ((count + error_count) == num) {
                                    stopPebble();
                                    //恭喜，已達成目標
                                    navigator.notification.vibrate(1000);
                                    f_media.play();
                                    f_media.seekTo(0);
                                } else {
                                    //已完成，請再次就定位
                                    navigator.notification.vibrate(1000);
                                    a_media.play();
                                    a_media.seekTo(0);
                                }
                            }
                        }
                        break;

                    case 6: //踢腿
                        if (test == 0) {
                            if (watch1_type7_start_lowerbound_x < xyz[0] && xyz[0] < watch1_type7_start_upperbound_x && watch1_type7_start_lowerbound_y < xyz[1] && xyz[1] < watch1_type7_start_upperbound_y) {
                                //判斷開始動作
                                s_media.play();
                                s_media.seekTo(0);
                                test = 1;
                            }
                        } else {
                            if (xyz[2] > watch1_type7_fail_lowerbound_z || xyz[2] < watch1_type7_fail_upperbound_z) {
                                //失敗(錯誤動作)               
                                interupt();
                                if ((count + error_count) == num) {
                                    stopPebble();
                                }
                            }
                            if (watch1_type7_success_lowerbound_x < xyz[0] && xyz[0] < watch1_type7_success_upperbound_x && watch1_type7_success_lowerbound_y < xyz[1] && xyz[1] < watch1_type7_success_upperbound_y) {
                                test = 0;
                                count++;
                                document.getElementById("times").innerHTML = "成功 " + count + " 次";
                                $('.f-times').html(++f_count); //目前次數 
                                //setProcess(f_count);
                                acce = 0;
                                if ((count + error_count) == num) {
                                    //恭喜，已達成目標
                                    stopPebble();
                                    navigator.notification.vibrate(1000);
                                    f_media.play();
                                    f_media.seekTo(0);
                                } else {
                                    //已完成，請再次就定位
                                    navigator.notification.vibrate(1000);
                                    a_media.play();
                                    a_media.seekTo(0);
                                }
                            }
                        }
                        break;

                    case 7: //挺腹
                        if (test == 0) {
                            if (watch1_type8_start_lowerbound_x < xyz[0] && xyz[0] < watch1_type8_start_upperbound_x && watch1_type8_start_lowerbound_y < xyz[1] && xyz[1] < watch1_type8_start_upperbound_y) {
                                //判斷開始動作
                                s_media.play();
                                s_media.seekTo(0);
                                test = 1;
                            }
                        } else {
                            if (watch1_type8_success_lowerbound_x < xyz[0] && xyz[0] < watch1_type8_success_upperbound_x && watch1_type8_success_lowerbound_y < xyz[1] && xyz[1] < watch1_type8_success_upperbound_y) {
                                test = 0;
                                count++;
                                document.getElementById("times").innerHTML = "成功 " + count + " 次";
                                $('.f-times').html(++f_count); //目前次數 
                                //setProcess(f_count);
                                acce = 0;
                                if ((count + error_count) == num) {
                                    //恭喜，已達成目標
                                    stopPebble();
                                    navigator.notification.vibrate(1000);
                                    f_media.play();
                                    f_media.seekTo(0);
                                } else {
                                    //已完成，請再次就定位
                                    navigator.notification.vibrate(1000);
                                    a_media.play();
                                    a_media.seekTo(0);
                                }
                            }
                        }
                        break;

                    case 8: //側抬腳
                        if (test == 0) {
                            if (watch1_type9_start_lowerbound_x < xyz[0] && xyz[0] < watch1_type9_start_upperbound_x && watch1_type9_start_lowerbound_y < xyz[1] && xyz[1] < watch1_type9_start_upperbound_y && watch1_type9_start_lowerbound_z < xyz[2] && xyz[2] < watch1_type9_start_upperbound_z) {
                                //判斷開始動作
                                s_media.play();
                                s_media.seekTo(0);
                                test = 1;
                            }
                        } else {
                            if (watch1_type9_success_lowerbound_x < xyz[0] && xyz[0] < watch1_type9_success_upperbound_x && watch1_type9_success_lowerbound_y < xyz[1] && xyz[1] < watch1_type9_success_upperbound_y && watch1_type9_success_lowerbound_z < Math.abs(xyz[2]) && Math.abs(xyz[2]) < type9_success_upperbound_z) {
                                test = 0;
                                count++;
                                document.getElementById("times").innerHTML = "成功 " + count + " 次";
                                $('.f-times').html(++f_count); //目前次數 
                                //setProcess(f_count);
                                acce = 0;
                                if ((count + error_count) == num) {
                                    //恭喜，已達成目標
                                    stopPebble();
                                    navigator.notification.vibrate(1000);
                                    f_media.play();
                                    f_media.seekTo(0);
                                } else {
                                    //已完成，請再次就定位
                                    navigator.notification.vibrate(1000);
                                    a_media.play();
                                    a_media.seekTo(0);
                                }
                            }
                            if (xyz[1] > watch1_type9_fail_lowerbound_y || xyz[1] < watch1_type9_fail_upperbound_y) {
                                //失敗(錯誤動作)     
                                interupt();
                                if ((count + error_count) == num) {
                                    stopPebble();
                                }
                            }
                        }
                        break;
						
					case 10: //側上斜舉
                        if (test == 0) {
                            if (watch1_type10_start_lowerbound_x < xyz[0] && xyz[0] < watch1_type10_start_upperbound_x && watch1_type10_start_lowerbound_y < xyz[1] && xyz[1] < watch1_type10_start_upperbound_y && watch1_type10_start_lowerbound_z < xyz[2] && xyz[2] < watch1_type10_start_upperbound_z) {
                                //判斷開始動作
								//alert(xyz[0]);
                                s_media.play();
                                s_media.seekTo(0);
                                test = 1;
                            }
                        } else {
                            if (watch1_type10_success_lowerbound_x < xyz[0] && xyz[0] < watch1_type10_success_upperbound_x && watch1_type10_success_lowerbound_y < xyz[1] && xyz[1] < watch1_type10_success_upperbound_y && watch1_type10_success_lowerbound_z < xyz[2] && xyz[2] < watch1_type10_success_upperbound_z) {
                                test = 0;
                                count++;
                                document.getElementById("times").innerHTML = "成功 " + count + " 次";
                                $('.f-times').html(++f_count); //目前次數 
                                //setProcess(f_count);
                                acce = 0;
                                if ((count + error_count) == num) {
                                    //恭喜，已達成目標
                                    stopPebble();
                                    navigator.notification.vibrate(1000);
                                    f_media.play();
                                    f_media.seekTo(0);
                                } else {
                                    //已完成，請再次就定位
                                    navigator.notification.vibrate(1000);
                                    a_media.play();
                                    a_media.seekTo(0);
                                }
                            }
                            if (xyz[1] > watch1_type10_fail_lowerbound_y || xyz[1] < watch1_type10_fail_upperbound_y) {
                                //失敗(錯誤動作)     
                                interupt();
                                if ((count + error_count) == num) {
                                    stopPebble();
                                }
                            }
                        }
                        break;
						
					case 11: //手部內彎前伸

                        if (test == 0) {
                            if (watch1_type11_start_lowerbound_x < xyz[0] && xyz[0] < watch1_type11_start_upperbound_x && watch1_type11_start_lowerbound_y < xyz[1] && xyz[1] < watch1_type11_start_upperbound_y && watch1_type11_start_lowerbound_z < xyz[2] && xyz[2] < watch1_type11_start_upperbound_z
								&&watch2_type11_start_lowerbound_x < xyz[3] && xyz[3] < watch2_type11_start_upperbound_x && watch2_type11_start_lowerbound_y < xyz[4] && xyz[4] < watch2_type11_start_upperbound_y&& watch2_type11_start_lowerbound_z < xyz[5] && xyz[5] < watch2_type11_start_upperbound_z) 
							{
                                //判斷開始動作
                                s_media.play();
                                s_media.seekTo(0);
                                test = 1;
                            }
                        } else {

                            if (watch1_type11_success_lowerbound_x < xyz[0] && xyz[0] < watch1_type11_success_upperbound_x && watch1_type11_success_lowerbound_y < xyz[1] && xyz[1] < watch1_type11_success_upperbound_y && watch1_type11_success_lowerbound_z < xyz[2] && xyz[2] < watch1_type11_success_upperbound_z
								&&watch2_type11_success_lowerbound_x < xyz[3] && xyz[3] < watch2_type11_success_upperbound_x && watch2_type11_success_lowerbound_y < xyz[4] && xyz[4] < watch2_type11_success_upperbound_y&& watch2_type11_success_lowerbound_z < xyz[5] && xyz[5] < watch2_type11_success_upperbound_z) {
                                //動作成功
                                test = 0;
                                count++;
                                document.getElementById("times").innerHTML = "成功 " + count + " 次";
                                $('.f-times').html(++f_count); //目前次數  
                                //setProcess(f_count);
                                acce = 0;
                                if ((count + error_count) == num) {
                                    stopPebble();
                                    navigator.notification.vibrate(1000);
                                    f_media.play();
                                    f_media.seekTo(0);
                                } else {
                                    navigator.notification.vibrate(1000);
                                    a_media.play();
                                    a_media.seekTo(0);
                                }
                            }
                        }
                        break;
                } /*--switch--*/
            } /*--acce--*/
        }
    }

    function stopPebble() //停止call passvalue
        {
            clearInterval(pe_frequency);
            var d = new Date();
            var year = d.getFullYear();
            var month = d.getMonth() + 1;
            var date = d.getDate();
            var hour = d.getHours();
            var minute = d.getMinutes();
            var second = d.getSeconds();
            if (month < 10) {
                month = "0" + month;
            }
            if (date < 10) {
                date = "0" + date;
            }
            if (hour < 10) {
                hour = "0" + hour;
            }
            if (minute < 10) {
                minute = "0" + minute;
            }
            if (second < 10) {
                second = "0" + second;
            }
            fd = year + "/" + month + "/" + date; //日期
            ft = hour + ":" + minute + ":" + second; //結束時間 
            var totals_count = count + error_count; //
            stopback();
            id_count++;
            insert(tempid, fd, Startime, ft, type, degree, num, count, error_count, totals_count); //MySql存入手機資料庫
            //update(); //上傳到server
            $.mobile.changePage("#show-page", null, true, true); //跳到->四種復健選擇畫面
            //showAlert() ;         //跳出 恭喜畫面 + 掌聲音樂
            switch (type) {
                case 0:
                    reha_name = "上舉";
                    break;
                case 1:
                    reha_name = "下放";
                    break;
                case 2:
                    reha_name = "右手摸耳(肩)";
                    break;
                case 3:
                    reha_name = "左手摸耳(肩)";
                    break;
                case 4:
                    reha_name = "右手摸耳";
                    break;
                case 5:
                    reha_name = "左手摸耳";
                    break;
                case 6:
                    reha_name = "踢腿";
                    break;
                case 7:
                    reha_name = "挺腹";
                    break;
                case 8:
                    reha_name = "側抬腿";
                    break;
				case 10:
                    reha_name = "側上斜舉";
                    break;
				case 11:
                    reha_name = "手部內彎前伸";
                    break;
            }
            document.getElementById("times").innerHTML = "成功 0 次";
            document.getElementById("errortimes").innerHTML = "失敗 0 次";
            document.getElementById("show_date").innerHTML = fd;
            document.getElementById("f_action").innerHTML = reha_name;
            document.getElementById("f_times").innerHTML = num;
            document.getElementById("f_degree").innerHTML = ((type == 0) ? degree + "°" : "無");
            if (type == 2 || type == 3) {
                document.getElementById("f_earlevel").innerHTML = "肩膀";
            } else if (type == 4 || type == 5) {
                document.getElementById("f_earlevel").innerHTML = "耳朵";
            } else {
                document.getElementById("f_earlevel").innerHTML = "無";
            }
            alert('成功' + count + '次，失敗' + error_count + '次。');
            document.getElementById("get_point").innerHTML = "獲得" + count + "點成就";
            $('#start_img').attr('src', 'css/ready/u31.png');
            $('.f-times').html(0); //目前次數
            $('.t-times').html("/" + num + "次"); //總次數
            acce = 0;
            more = false;
        }

    function get_detail() { //get the value of select tag & 做復健動作開始初始準備
        var action = parseInt($('#action-choice').val()); ////action:動作類型
        num = parseInt($('#times-choice').val()); //times:次數
        degree = parseInt($('#degree-choice').val()); //degree:幾度
        var hand = $('#level-choice').val(); //hand:左右手 有成功?
        var level_ear = $('#ear-choice').val(); //level_ear:摸耳朵程度
        var is_Pebble_Connected = false; //測試Pebble是否連接
        var acc;
        var pebble_count = 0;
        var sony_connect = false;
        var sony_count = 0;
        var first_acc = 0;
        //-----------------開始載入手表插件
        watch_choice = $('#watch-choice').val();
		
		//檢查option
		if ($('#action-choice').val() == "未選擇" || $('#times-choice').val() == "未選擇" || $('#degree-choice').val() == "未選擇" || hand == "未選擇" || level_ear == "未選擇" || watch_choice == "未選擇"){
			alert('請重新選好每個選項，返回上一頁');
			window.location.href = "w_index.html";
		}
        //利用接收到的值判斷手機是否有與pebble連接
        if (watch_choice == 0) {
            loadBluetoothPlugin();
            //for(var i = 0; i < 5; i++){
            var intInterval = setInterval(function() {
                window.plugins.BluetoothPlugin.passValue(function(data) {
                    pebble_count++;
                    acc = data.split("+", 3);
                    if (pebble_count == 1) {
                        first_acc = acc[2];
                    }
                    //alert(acc[2]);
                    if (acc[2] != undefined && acc[2] != first_acc) {
                        is_Pebble_Connected = true;
                    }
                }, function() {
                    alert("error");
                });
                if (pebble_count == 4) {
                    clearInterval(intInterval);
                    if (!is_Pebble_Connected) {
                        alert('手機尚未與手表連接，連接方法可參考PEBBLE使用手冊');
                        window.location.href = "w_index.html";
                    }
                }
            }, 250);
            //}
        } else if (watch_choice == 1) {
            watch_type = 1;
            loadSmartWatch2();
            var intInterval = setInterval(function() {
                window.plugins.GetValue.passValue(function(data) {
                    if (data != "not connect" && data != null)
                        sony_connect = true;
                }, function() {
                    alert("error");
                });
                if (sony_count == 4) {
                    clearInterval(intInterval);
                    if (!sony_connect) {
                        alert('手機尚未與手表連接，連接方法可參考SonySmartWatch使用手冊');
                        window.location.href = "w_index.html";
                    }
                }
                sony_count++;
            }, 250);
        } else if (watch_choice == 2) {
            watch_type = 1;
            loadBluetoothPlugin();
            window.plugins.PluginTest.buildSocket(function(data) {
                    if (data == 'Do not have paired device' || data == 'Can not find geak app') {
                        alert('手機尚未與手表連接，連接方法可參考GEAK連接手冊');
                        window.location.href = "w_index.html";
                    }
                },
                function(e) {
                    alert(e);
                });
				
            // window.plugins.PluginTest.init(function (data){
            //  alert(data);
            // }
            // , function(e){
            //  alert(e);
            // });


        } else if (watch_choice == 3) {
            watch_type = 1;
            loadAndroidWear();
            window.plugins.AndroidWear.start(function(data) {
                    if (data == 'Watch one offline') {
                        alert('沒有手錶_1的連線，請確認有開啟藍芽並與Android Wear 連線');
                        window.location.href = "w_index.html";
                    }
                },
                function(e) {
                    alert(e);
                });
        }
        switch (action) {
            case 0: //上舉
                level_ear = 0; //無摸耳程度
                hand = 0; //無左右手
                type = 0;
                $(".img_action").attr('src', 'css/images/raise.png'); //change img of #ready_page
                $('.video_action').attr('src', 'video/raise_correct.mp4'); //change video of #ready_page
                $(".do_img").attr('src', 'css/images/raise_angle.png'); //change img of #do-page
                $(".action_h").html("上舉" + degree + "°"); //改變#ready_page動作類型
                $(".notice_p").html("※注意:請把聲音和藍芽開啟※</br>請把手錶戴在左手，錶面朝左");
                break;
            case 1: //下放
                degree = 0 //無角度
                level_ear = 0; //無摸耳程度
                hand = 0; //無左右手
                type = 1;
                $(".img_action").attr('src', "css/images/lower.png");
                $('.video_action').attr('src', 'video/lower_correct.mp4'); //change video of #ready_page
                $(".do_img").attr('src', 'css/images/lower.png'); //change img of #do-page
                $(".action_h").html("下放"); //改變#ready_page動作類型
                $(".notice_p").html("※注意:請把聲音和藍芽開啟※</br>請把手錶戴在左手，錶面朝左");
                break;
            case 2: //摸耳朵
                degree = 0 //無角度
                $(".img_action").attr('src', "css/images/ear.png");
                $('.video_action').attr('src', 'video/ear_correct.mp4'); //change video of #ready_page
                $(".do_img").attr('src', 'css/images/ear.png'); //change img of #do-page
                $(".action_h").html("摸耳朵:" + ((hand == 'L') ? "左手" : "右手") + ((level_ear == 'S') ? "到肩膀" : "到耳朵")); //改變#ready_page動作類型
                $(".notice_p").html("※注意:請把聲音和藍芽開啟※</br>請把手錶戴在左或右手，");
                if (level_ear == 'S') {
                    if (hand == 'R') { //右手肩膀
                        type = 2;
                    } else if (hand == 'L') { //左手肩膀
                        type = 3;
                    }
                } else if (level_ear == 'E') {
                    if (hand == 'R') { //右手耳朵
                        type = 4;
                    } else if (hand == 'L') { //左手耳朵
                        type = 5;
                    }
                }
                break;
            case 6: //踢腿
                degree = 0 //無角度
                level_ear = 0; //無摸耳程度
                hand = 0; //無左右手
                type = 6;
                $(".img_action").attr('src', "css/images/kick.png");
                $('.video_action').attr('src', 'video/raise_correct.mp4'); //change video of #ready_page
                $(".do_img").attr('src', 'css/images/kick.png'); //change img of #do-page
                $(".action_h").html("踢腿"); //改變#ready_page動作類型
                $(".notice_p").html("※注意:請把聲音和藍芽開啟※</br>手錶綁在腳的右側(如果你可以綁的話XD)");
                break;
            case 7: //挺腹
                degree = 0 //無角度
                level_ear = 0; //無摸耳程度
                hand = 0; //無左右手
                type = 7;
                $(".img_action").attr('src', "css/images/stomach.png");
                $('.video_action').attr('src', 'video/raise_correct.mp4'); //change video of #ready_page
                $(".do_img").attr('src', 'css/images/stomach.png'); //change img of #do-page
                $(".action_h").html("挺腹"); //改變#ready_page動作類型
                $(".notice_p").html("※注意:請把聲音和藍芽開啟※</br>請把手錶平貼於肚上，放在肚臍下方並把手錶朝自己、面朝上");
                break;
            case 8: //側抬腿
                degree = 0 //無角度
                level_ear = 0; //無摸耳程度
                hand = 0; //無左右手
                type = 8;
                $(".img_action").attr('src', "css/images/leg.png");
                $('.video_action').attr('src', 'video/raise_correct.mp4'); //change video of #ready_page
                $(".do_img").attr('src', 'css/images/leg.png'); //change img of #do-page
                $(".action_h").html("側抬腿"); //改變#ready_page動作類型
                $(".notice_p").html("※注意:請把聲音和藍芽開啟※</br>手錶綁在腳的右側(如果你可以綁的話XD)");
                break;
				
			case 10: //側上斜舉
                degree = 0 //無角度
                level_ear = 0; //無摸耳程度
                hand = 0; //無左右手
                type = 10;
                $(".img_action").attr('src', "css/images/arm_left.jpg");
                $('.video_action').attr('src', 'video/raise_correct.mp4'); //change video of #ready_page
                $(".do_img").attr('src', 'css/images/arm_left.jpg'); //change img of #do-page
                $(".action_h").html("側上斜舉"); //改變#ready_page動作類型
                $(".notice_p").html("※注意:請把聲音和藍芽開啟※");
                break;
				
			case 11: //手部內彎前伸
                degree = 0 //無角度
                level_ear = 0; //無摸耳程度
                hand = 0; //無左右手
                type = 11;
                $(".img_action").attr('src', "css/images/bend.png");
                $('.video_action').attr('src', 'video/bend_correct.mp4'); //change video of #ready_page
                $(".do_img").attr('src', 'css/images/bend.png'); //change img of #do-page
                $(".action_h").html("手部內彎前伸"); //改變#ready_page動作類型
                $(".notice_p").html("※注意:請把聲音和藍芽開啟※</br>兩隻手錶綁在左手和左臂");
                break;
        }
        //固定進入頁面先顯示圖片
        $('#picture_img').attr('src', 'css/ready/u39_selected.png');
        $('#video_img').attr('src', 'css/ready/u37.png');
        $('.video_action').css('display', 'none');
        $('.img_action').css('display', 'block');
        if (action != 9)
            $.mobile.changePage("#ready-page", null, true, true);
        else
        // Test
            $.mobile.changePage("#test-page", null, true, true);
        processlength = 100 / num;
        acce = 0; //一定要歸零!
        count = 0; //成功次數歸零
        error_count = 0; //失敗次數歸零
        f_count = 0;
        $('.f-times').html(f_count); //目前次數
        $('.t-times').html("/" + num + "次"); //總次數
        document.getElementById("times").innerHTML = "成功 0 次";
        document.getElementById("errortimes").innerHTML = "失敗 0 次";
    }
    </script>
    <script>
    /*---------- 點我返回 ----------*/
    function ctheme(color) {
        if (color == "a") {
            $("#a").css("background", "-webkit-linear-gradient(#69bde4,#8cdedc)");
            $("#a").css("background", "o-linear-gradient(#69bde4,#8cdedc)");
            $("#a").css("background", "-moz-linear-gradient(#69bde4,#8cdedc)");
            $("#a").css("background", "linear-gradient(#69bde4,#8cdedc)");
            $("#a").css("color", "#FFF");
            cc = 1;
        } else if (color == "b" && cc == 1) {
            $("#b").css("background", "-webkit-linear-gradient(#69bde4,#8cdedc)");
            $("#b").css("background", "o-linear-gradient(#69bde4,#8cdedc)");
            $("#b").css("background", "-moz-linear-gradient(#69bde4,#8cdedc)");
            $("#b").css("background", "linear-gradient(#69bde4,#8cdedc)");
            $("#b").css("color", "#FFF");
            cc = 2;
        } else if (color == "c" && cc == 2) {
            $("#c").css("background", "-webkit-linear-gradient(#69bde4,#8cdedc)");
            $("#c").css("background", "o-linear-gradient(#69bde4,#8cdedc)");
            $("#c").css("background", "-moz-linear-gradient(#69bde4,#8cdedc)");
            $("#c").css("background", "linear-gradient(#69bde4,#8cdedc)");
            $("#c").css("color", "#FFF");
            cc = 3;
        } else {
            if (color == "d" && cc == 3) {
                $("#d").css("background", "-webkit-linear-gradient(#69bde4,#8cdedc)");
                $("#d").css("background", "o-linear-gradient(#69bde4,#8cdedc)");
                $("#d").css("background", "-moz-linear-gradient(#69bde4,#8cdedc)");
                $("#d").css("background", "linear-gradient(#69bde4,#8cdedc)");
                $("#d").css("color", "#FFF");
                //stopPhoneSensor();
                stopPebble();
                $("#a").css("background", "-webkit-linear-gradient(#f2eddf,#e1ddda)");
                $("#b").css("background", "-webkit-linear-gradient(#f2eddf,#e1ddda)");
                $("#c").css("background", "-webkit-linear-gradient(#f2eddf,#e1ddda)");
                $("#d").css("background", "-webkit-linear-gradient(#f2eddf,#e1ddda)");
                $("#a").css("background", "-o-linear-gradient(#f2eddf,#e1ddda)");
                $("#b").css("background", "-o-linear-gradient(#f2eddf,#e1ddda)");
                $("#c").css("background", "-o-linear-gradient(#f2eddf,#e1ddda)");
                $("#d").css("background", "-o-linear-gradient(#f2eddf,#e1ddda)");
                $("#a").css("background", "-moz-linear-gradient(#f2eddf,#e1ddda)");
                $("#b").css("background", "-moz-linear-gradient(#f2eddf,#e1ddda)");
                $("#c").css("background", "-moz-linear-gradient(#f2eddf,#e1ddda)");
                $("#d").css("background", "-moz-linear-gradient(#f2eddf,#e1ddda)");
                $("#a").css("background", "linear-gradient(#f2eddf,#e1ddda)");
                $("#b").css("background", "linear-gradient(#f2eddf,#e1ddda)");
                $("#c").css("background", "linear-gradient(#f2eddf,#e1ddda)");
                $("#d").css("background", "linear-gradient(#f2eddf,#e1ddda)");
                $("#a").css("color", "#333");
                $("#b").css("color", "#333");
                $("#c").css("color", "#333");
                $("#d").css("color", "#333");
            }
        }
    }
    </script>
    <script>
    /*----------音樂-------------*/
    var r_media = null;
    var p_media = null;
    var s_media = null;
    var a_media = null;
    var f_media = null;
    var e_media = null;

    function playmusic() {
        var urlr = "/android_asset/www/css/images/ready.mp3"; /*-----請就定位 ready.mp3-----*/
        r_media = new Media(urlr,
            function() {},
            function(err) {
                //  console.log("Music Error: "+err);
            });

        var urlp = "/android_asset/www/css/images/plause.mp3"; //掌聲音樂
        p_media = new Media(urlp,
            function() {},
            function(err) {
                //  console.log("Music Error: "+err);
            });

        var urls = "/android_asset/www/css/images/start.mp3"; /*-----開始 start.mp3-----*/
        s_media = new Media(urls,
            function() {},
            function(err) {
                //  console.log("Music Error: "+err);
            });

        var urla = "/android_asset/www/css/images/again.mp3"; /*-----已完成，請再次就定位 again.mp3-----*/
        a_media = new Media(urla,
            function() {},
            function(err) {
                //  console.log("Music Error: "+err);
            });

        var urlf = "/android_asset/www/css/images/finish.mp3"; /*-----恭喜，已達成目標 finish.mp3-----*/
        f_media = new Media(urlf,
            function() {},
            function(err) {
                //  console.log("Music Error: "+err);
            });

        var urle = "/android_asset/www/css/images/error.mp3"; /*-----動作錯誤，請從新開始 error.mp3-----*/
        e_media = new Media(urle,
            function() {},
            function(err) {
                //  console.log("Music Error: "+err);
            });
    }

    var back_media = null; //must be global variable so latter can be used by other function to stop
    //mus decide which music to play
    function playback() {
        var url = "/android_asset/www/css/images/marry.mp3"; //遊戲背景音樂
        back_media = new Media(url,
            function() {},
            function(err) {});

    }

    var backtimer;

    function loopback() {
        back_media.play();
        backtimer = setInterval(function() {
            back_media.seekTo(0);
            back_media.play();
        }, 112000);
    }

    function stopback() {
        back_media.stop();
        back_media.seekTo(0);
        clearInterval(backtimer);
        backtimer = null;
    }
    </script>
    <script type="text/javascript">
    function playvideo(url) {
        openpopupvideo(url);
    }

    function openpopupvideo(url) {
        $("#videoTag").empty();
        $("#videoTag").append(
            '<source src="' + url + '" type="video/ogv">'
        );
    }
    </script>
    <script type="text/javascript">
    /*處理自定義button按壓事件*/
    /*#登入按鈕*/
    $(document).on('vmousedown', '#login_btn', function() {
        $('#login_img').attr('src', 'img/u12_mouseDown.png');
    });
    $(document).on('vmouseup', '#login_btn', function() {
        $('#login_img').attr('src', 'img/u12.png');
    });
    $(document).on('vmousecancel', '#login_btn', function() {
        $('#login_img').attr('src', 'img/u12.png');
    });
    $(document).on('vclick', '#login_btn', function() {
        addUserID();
    });

    /*#main_page 準備按鈕*/
    $(document).on('vmousedown', '#ready_img', function() {
        $('#ready_img').attr('src', 'img/ready_mouseDown.png');
    });
    $(document).on('vmouseup', '#ready_img', function() {
        $('#ready_img').attr('src', 'img/ready.png');
    });
    $(document).on('vmousecancel', '#ready_img', function() {
        $('#ready_img').attr('src', 'img/ready.png');
    });
    $(document).on('vclick', '#ready_img', function() {
        get_detail();
    });

    /*#ready_page 開始按鈕*/
    $(document).on('vmousedown', '#start_img', function() {
        if (more == false) {
            $('#start_img').attr('src', 'css/ready/u31_mouseDown.png');
        }
    });
    $(document).on('vmouseup', '#start_img', function() {
        if (more == false) {
            $('#start_img').attr('src', 'css/ready/u31.png');
        }
    });
    $(document).on('vmousecancel', '#start_img', function() {
        if (more == false) {
            $('#start_img').attr('src', 'css/ready/u31.png');
        }
    });
    $(document).on('vclick', '#start_img', function(e) {
        //checkConnectPebble();  //開始前系統檢查有沒有連接
        if (more == false) {
            more = true;
            $('#start_img').attr('src', 'css/images/t3-1.png');
            var a = 3;
            var b = 2;
            countdownid = window.setInterval(countdownfunc, 333);

            function countdownfunc() {
                if (a == 0) {
                    document.getElementById("start_img").src = 'css/images/t1-3.png';
                } else {
                    document.getElementById("start_img").src = 'css/images/t' + a + '-' + b + '.png';
                }
                b++;
                if (b == 4) {
                    b = 1;
                    a--;
                    if (a == -1) { //會有延遲
                        clearInterval(countdownid);
                        $.mobile.changePage('#do-page', null, true, true);
                        //startWatch();  //手機
                        start_action(); //手錶
                    }
                }
            };
        } else {
            /*do nothing*/
        }
    });

    /*確認藍芽鍵*/
    $(document).on('vclick', '.bluetooth_img', function() {
        //checkConnectPebble();
    });

    /*#ready_page 影片按鈕*/
    $(document).on('vmousedown', '#video_img', function() {
        $('#video_img').attr('src', 'css/ready/u37_selected.png');
    });
    $(document).on('vmouseup', '#video_img', function() {
        $('#video_img').attr('src', 'css/ready/u37.png');
    });
    $(document).on('vmousecancel', '#video_img', function() {
        $('#video_img').attr('src', 'css/ready/u37.png');
    });
    $(document).on('vclick', '#video_img', function() {
        $('#video_img').attr('src', 'css/ready/u37_selected.png');
        $('#picture_img').attr('src', 'css/ready/u39.png');
        $('.video_action').css('display', 'block');
        $('.img_action').css('display', 'none');
    });

    /*#ready_page 圖片按鈕*/
    $(document).on('vmousedown', '#picture_img', function() {
        $('#picture_img').attr('src', 'css/ready/u39_selected.png');
    });
    $(document).on('vmouseup', '#picture_img', function() {
        $('#picture_img').attr('src', 'css/ready/u39.png');
    });
    $(document).on('vmousecancel', '#picture_img', function() {
        $('#picture_img').attr('src', 'css/ready/u39.png');
    });
    $(document).on('vclick', '#picture_img', function() {
        $('#picture_img').attr('src', 'css/ready/u39_selected.png');
        $('#video_img').attr('src', 'css/ready/u37.png');
        $('.video_action').css('display', 'none');
        $('.img_action').css('display', 'block');
    });

    /*返回鍵*/
    $(document).on('vmouseup', '.back', function() {
        $('.back img').attr('src', 'css/images/u24.png');
    });
    $(document).on('vmousedown', '.back', function() {
        $('.back img').attr('src', 'css/images/u24_mouseDown.png');
    });
    $(document).on('vmousecancel', '.back', function() {
        $('.back img').attr('src', 'css/images/u24.png');
    });
    $(document).on('vclick', '.back', function() {
        $.mobile.changePage("#main-page", null, true, true);
    });

    /*右上角問號鍵*/
    $(document).on('vmouseup', '.know img', function() {
        $('.know img').attr('src', 'css/ready/u23.png');
    });
    $(document).on('vmousedown', '.know img', function() {
        $('.know img').attr('src', 'css/ready/u23_mouseDown.png');
    });
    $(document).on('vmousecancel', '.know img', function() {
        $('.know img').attr('src', 'css/ready/u23.png');
    });
    $(document).on('vclick', '.know img', function() {
        alert("版本資訊:AnyWear 2.0");
    });

    /*#show-page 上傳鍵*/
    $(document).on('vmouseup', '#upload_btn img', function() {
        $('#upload_btn img').attr('src', 'img/u63.png');
    });
    $(document).on('vmousedown', '#upload_btn img', function() {
        $('#upload_btn img').attr('src', 'img/u63_mouseDown.png');
    });
    $(document).on('vmousecancel', '#upload_btn img', function() {
        $('#upload_btn img').attr('src', 'img/u63.png');
    });
    $(document).on('vclick', '#upload_btn img', function() {
        update();
    });

    /*#show-page 再一次鍵*/
    $(document).on('vmouseup', '#again_btn img', function() {
        $('#again_btn img').attr('src', 'img/u65.png');
    });
    $(document).on('vmousedown', '#again_btn img', function() {
        $('#again_btn img').attr('src', 'img/u65_mouseDown.png');
    });
    $(document).on('vmousecancel', '#again_btn img', function() {
        $('#again_btn img').attr('src', 'img/u65.png');
    });
    $(document).on('vclick', '#again_btn img', function() {
        $.mobile.changePage('#do-page', null, true, true);
        //startWatch();  //手機
        start_action(); //手錶    
    });

    /*#show-page 離開鍵*/
    $(document).on('vmouseup', '#leave_btn img', function() {
        $('#leave_btn img').attr('src', 'img/u67.png');
    });
    $(document).on('vmousedown', '#leave_btn img', function() {
        $('#leave_btn img').attr('src', 'img/u67_mouseDown.png');
    });
    $(document).on('vmousecancel', '#leave_btn img', function() {
        $('#leave_btn img').attr('src', 'img/u67.png');
    });
    $(document).on('vclick', '#leave_btn img', function() {
        $.mobile.changePage("#main-page", null, true, true);
    });

    /*#learn-page 右邊兩個icon*/
    $(document).on('vclick', '.leran_v', function() {
        $('.leran_v img').attr('src', 'css/learn/u37_selected.png');
        $('.leran_p img').attr('src', 'css/learn/u39.png');
        $('.leran_hand img').attr('src', 'css/learn/Icon_Hold_Normal.png');
        $('.leran_demo img').attr('src', 'css/learn/Icon_Demo_Normal.png');
        $('.movie_div').css('display', 'block');
        $('.hold_div').css('display', 'none');
        $('.demo_div').css('display', 'none');
    });
    $(document).on('vclick', '.leran_p', function() {
        $('.leran_v img').attr('src', 'css/learn/u37.png');
        $('.leran_p img').attr('src', 'css/learn/u39_selected.png');
        $('.leran_hand img').attr('src', 'css/learn/Icon_Hold_Down.png');
        $('.leran_demo img').attr('src', 'css/learn/Icon_Demo_Normal.png');
        $('.movie_div').css('display', 'none');
        $('.hold_div').css('display', 'block');
        $('.demo_div').css('display', 'none');
    });
    $(document).on('vclick', '.leran_hand', function() {
        $('.leran_v img').attr('src', 'css/learn/u37.png');
        $('.leran_p img').attr('src', 'css/learn/u39_selected.png');
        $('.leran_hand img').attr('src', 'css/learn/Icon_Hold_Down.png');
        $('.leran_demo img').attr('src', 'css/learn/Icon_Demo_Normal.png');
        $('.movie_div').css('display', 'none');
        $('.hold_div').css('display', 'block');
        $('.demo_div').css('display', 'none');
    });
    $(document).on('vclick', '.leran_demo', function() {
        $('.leran_v img').attr('src', 'css/learn/u37.png');
        $('.leran_p img').attr('src', 'css/learn/u39_selected.png');
        $('.leran_hand img').attr('src', 'css/learn/Icon_Hold_Normal.png');
        $('.leran_demo img').attr('src', 'css/learn/Icon_Demo_Down.png');
        $('.movie_div').css('display', 'none');
        $('.hold_div').css('display', 'none');
        $('.demo_div').css('display', 'block');
    });

    /*#track-page 上傳鍵*/
    $(document).on('vmouseup', '#uploadall_btn img', function() {
        $('#uploadall_btn img').attr('src', 'img/u63.png');
    });
    $(document).on('vmousedown', '#uploadall_btn img', function() {
        $('#uploadall_btn img').attr('src', 'img/u63_mouseDown.png');
    });
    $(document).on('vmousecancel', '#uploadall_btn img', function() {
        $('#uploadall_btn img').attr('src', 'img/u63.png');
    });
    $(document).on('vclick', '#uploadall_btn img', function() {
        uploadALL();
    });
    </script>
    <!-- 測試 -->
    <script type="text/javascript">
    function showAcc() {
        window.plugins.BluetoothPlugin.passValue(function(data) {
            acceleration = data.split("+", 3);
            $("#test_p").append("[" + test_count++ + "]" + ".  x: " + acceleration[0] + "  y: " + acceleration[1] + "  z: " + acceleration[2] + "<br>");
            //alert(acceleration);
        }, function() {
            alert("error");
        });
    }

    function goBack() {
        test_count = 1;
        $("#test_p").html("");
        $.mobile.changePage("#main-page", null, true, true);
    }
    </script>
    <!-- 中風因子量表 -->
    <script type="text/javascript">
    var gender = 0;

    function gotoStrokeScale_male() {
        gender = 1;
        $.mobile.changePage("#strokeScale", null, true, true);
    }

    function gotoStrokeScale_female() {
        gender = 0;
        $.mobile.changePage("#strokeScale", null, true, true);
    }

    function doOutput() {
        var prob;
        var sum = 0,
            age = 0,
            sbp = 0,
            hyprx = 0,
            diabetes = 0,
            cigs = 0,
            cvd = 0,
            af = 0,
            lvh = 0;
        // 男性
        if (gender == 1) {
            var array = new Array("2.6", "3.0", "3.5", "4.0", "4.7", "5.4", "6.3", "7.3", "8.4",
                "9.7", "11.2", "12.9", "14.8", "17.0", "19.5", "22.4", "25.5", "29.0",
                "32.9", "37.1", "41.7", "46.6", "51.8", "57.3", "62.4", "68.4", "73.8",
                "79.0", "83.7", "87.9");
        };
        // 女性
        if (gender == 0) {
            var array = new Array("1.1", "1.3", "1.6", "2.0", "2.4", "2.9", "3.5", "4.3", "5.2",
                "6.3", "7.6", "9.2", "11.1", "13.3", "16.0", "19.1", "22.8", "27.0",
                "31.9", "37.3", "43.4", "50.0", "57.0", "64.2", "71.4", "78.2", "84.4");
        };
        var showtext = "所評估之10年內中風機率為:";

        //  age = $('select[name="age"]').val();
        age = parseInt($('select#age').val());
        sbp = parseInt($('select#sbp').val());
        hyprx = parseInt($('select#hyprx').val());
        diabetes = parseInt($('select#diabetes').val());
        cigs = parseInt($('select#cigs').val());
        cvd = parseInt($('select#cvd').val());
        af = parseInt($('select#af').val());
        lvh = parseInt($('select#lvh').val());

        sum = age + sbp + hyprx + diabetes + cigs + cvd + af + lvh;

        if (sum <= 0) {
            showtext = "依目前篩選資料，您尚未符合高風險評估範圍，所以無法評估。";
            alert(showtext);

        } else {
            showtext = showtext + array[sum - 1] + "%";
            alert(showtext);
        }
    }
    </script>
    <style>
    </style>
</head>

<body>
    <div data-role="page">
        <div data-role="content" id="newID">
            <img src="css/login/Logo_login_w.png" id="login_p1">
            <div id="input_div">
                <input type="text" id="text_id" placeholder="收案代號" name="ID">
                <img src="css/login/people.png" id="in_people">
            </div>
            <div id="login_btn"><img src="img/u12.png" id="login_img"></div>
            <div id="ID_footer">
                <img src="img/u14.png" id="login_p2">
            </div>
        </div>
    </div>
    <div data-role="page" id="main-page">
        <div data-role="header" id="start_header">
            <h1>MedicalSuite</h1>
            <div class="know"><img src="css/images/u23.png"></div>
            <div data-role="navbar">
                <ul>
                    <li>
                        <a href="#" data-href="tab-1" class="ui-btn-active" data-icon="start">
                            <p class="barp">開始</p>
                        </a>
                    </li>
                    <li>
                        <a href="#" data-href="tab-2" data-icon="train">
                            <p class="barp">教學</p>
                        </a>
                    </li>
                    <li>
                        <a href="#" data-href="tab-3" data-icon="record">
                            <p class="barp">記錄</p>
                        </a>
                    </li>
                    <li>
                        <a onclick="self.location.href='ebook.html'" data-icon="ebook">
                            <p class="barp">電子書</p>
                        </a>
                    </li>
                    <li>
                        <a href="#" data-href="tab-5" data-icon="scale">
                            <p class="barp">中風因子</p>
                        </a>
                    </li>
                </ul>
            </div>
            <!-- navbar -->
            <div class="know"><img src="css/images/u23.png"></div>
        </div>
        <!-- header -->
        <div class="tab-container">
            <div id="tab-1" class="tab-page">
                <div data-role="content" id="start_content">
                    <div data-role="navbar">
                        <ul>
                            <li><a href="#" data-href="tab-dolist" onclick="loadActionData()">本日復健動作列表</a></li>
                            <li><a href="#" data-href="tab-gg">自主復健</a></li>
                        </ul>
                    </div>
                    <!-- navbar -->
                    <!--                            <a id ="dolist" href="#" data-href="tab-dolist" data-type="button" >本日復健動作列表</a>
                            <a id ="doself" href="#" data-href="tab-dolist" data-type="button" >本日復健動作列表</a> -->
                    <!--                            <a href="#"> <button onclick="loadActionData()">本日復健動作列表</button> </a>
                             <button><a href="#" data-href="tab-gg">自主復健</a></button>  -->
                    <!-- <input type="button" class="ui-btn-left" value ="本日復健動作列表"  onclick="loadActionData()">
                            <input type="button" data-href="tab-1" class="ui-btn-left" value ="自主復健"> -->
                    <!--                            <button id ="dolist" data-href="tab-dolist">本日復健動作列表</button>
                            <button id = "doself" data-href="tab-1">自主復健</button> -->
                </div>
            </div>
            <div id="tab-gg" class="tab-page">
                <div class="detail">
                    <div id="btext">
                        <p id="main-text">請選擇動作次數</p>
                    </div>
                    <ul id="detail_ul">
                        <li id="action_li">
                            <img src="img/u35.png" class="detail_img">
                            <label>動作</label>
                            <select id="action-choice" name="action-choice" data-icon="Rarrow" onchange="changeFunc(value);">
                                <option selected disabled>未選擇</option>
								<option value="0">上舉</option>
                                <option value="1">下放</option>
                                <option value="2">摸耳朵</option>
                                <option value="6">踢腿</option>
                                <option value="7">挺腹</option>
                                <option value="8">側抬腿</option>
								<option value="10">側上斜舉</option>
								<option value="11">手部內彎前伸</option>
                                <!--<option value="9">Test</option>-->
                            </select>
                        </li>
                        <li id="times_li">
                            <img src="img/u46.png" class="detail_img">
                            <label>次數</label>
                            <select id="times-choice" name="times-choice" data-icon="Rarrow">
                                <!--option value="1">1-test</option>
                                        <option value="3">3-test</option-->
								<option selected disabled>未選擇</option>
                                <option value="5">5</option>
                                <option value="10">10</option>
                                <option value="15">15</option>
                                <option value="20">20</option>
                                <option value="25">25</option>
                                <option value="30">30</option>
                                <option value="35">35</option>
                                <option value="40">40</option>
                                <option value="45">45</option>
                                <option value="50">50</option>
                            </select>
                        </li>
                        <li id="degree_li">
                            <img src="img/u57.png" class="detail_img">
                            <label>角度</label>
                            <select id="degree-choice" name="degree-choice" data-icon="Rarrow">
								<option selected disabled>未選擇</option>
                                <option value="90">90°</option>
                                <option value="120">120°</option>
                                <option value="180">180°</option>
                            </select>
                        </li>
                        <li id="hand_choice">
                            <img src="img/Icon_Hand.png" class="detail_img">
                            <label>左右手</label>
                            <select id="level-choice" name="level-choice" data-icon="Rarrow">
								<option selected disabled>未選擇</option>
								<option value='L'>左手</option>
                                <option value='R'>右手</option>
                            </select>
                        </li>
                        <li id="ear_li">
                            <img src="img/u68.png" class="detail_img">
                            <label>位置</label>
                            <select id="ear-choice" name="ear-choice" data-icon="Rarrow">
								<option selected disabled>未選擇</option>
                                <option value='S'>肩膀</option>
                                <option value='E'>耳朵</option>
                            </select>
                        </li>
                        <!-- rate test -->
                        <li id="rate_li">
                            <img src="img/u35.png" class="detail_img">
                            <label>手錶</label>
                            <select id="watch-choice" data-icon="Rarrow">
								<option selected disabled>未選擇</option>
                                <option value="0">Pebble</option>
                                <option value="1">SmartWatch2</option>
                                <option value="2">Geak</option>
								<option value="3">AndroidWear</option>
                            </select>
                        </li>
                    </ul>
                </div>
                <div class="btns">
                    <img src="css/start/ready.png" id="ready_img">
                    <!--img src="css/images/Icon_Watch_Normal.png" class="bluetooth_img"-->
                    <!--img src="css/start/sound.png" id="sound_img"-->
                </div>
            </div>
            <div id="tab-smartwatch2" class="tab-page">
                <input type="button" id="wbutton" value="start"></input>
                <div id="textX"></div>
                <div id="textY"></div>
                <div id="textZ"></div>
            </div>
            <div id="tab-gball" class="tab-page">
                <button id="gbutton">start</button>
                <canvas id="myCanvas"></canvas>
                <footer>
                    <table id="footerTable">
                        <tr>
                            <td>X: <span id="xOut">0</span></td>
                            <td>Y: <span id="yOut">0</span></td>
                            <td>Z: <span id="zOut">0</span></td>
                        </tr>
                    </table>
                </footer>
            </div>
            <div id="tab-dolist" class="tab-page">
                <div data-role="content">
                    <div id="glist">
                        <!-- <ul data-role="listview" data-inset="true" > 

                                </ul> -->
                    </div>
                </div>
            </div>
            <!--learn -->
            <div id="tab-2" class="tab-page">
                <div data-role="content" id="learn_content">
                    <!-- navbar -->
                    <div data-role="navbar">
                        <ul id="learn_ul">
                            <li>
                                <div class="bar_div leran_v"><img src="css/learn/u37.png" class="bar_img">
                                    <p>影片示範</p>
                                </div>
                            </li>
                            <li>
                                <div class="bar_div leran_p"><img src="css/learn/u39_selected.png" class="bar_img">
                                    <p>圖片示範</p>
                                </div>
                            </li>
                            <li>
                                <!--中間留空用(勿刪)-->
                            </li>
                            <li>
                                <div class="bar_div leran_hand"><img src="css/learn/Icon_Hold_Down.png" class="bar_img">
                                    <p>握法</p>
                                </div>
                            </li>
                            <li>
                                <div class="bar_div leran_demo"><img src="css/learn/Icon_Demo_Normal.png" class="bar_img">
                                    <p>示範</p>
                                </div>
                            </li>
                        </ul>
                    </div>
                    <div id="learn_container">
                        <div class=" movie_div" style="display:none;">
                            <!--影片無法播放-->
                            <!--上肢正確示範-->
                            <a data-role="button" href="#videoWindow" data-rel="popup" data-position-to="window" data-transition="pop" onclick="playvideo('file:///android_asset/www/video/raise_correct.mp4')">上舉示範影片</a>
                            <a data-role="button" href="#videoWindow" data-rel="popup" data-position-to="window" data-transition="pop" onclick="playvideo('file:///android_asset/www/video/lower_correct.mp4')">下放示範影片</a>
                            <a data-role="button" href="#videoWindow" data-rel="popup" data-position-to="window" data-transition="pop" onclick="playvideo('file:///android_asset/www/video/ear_correct.mp4')">耳朵示範影片</a>
                            <!--上肢錯誤示範-->
                            <a data-role="button" href="#videoWindow" data-rel="popup" data-position-to="window" data-transition="pop" onclick="playvideo('file:///android_asset/www/video/raise_incorrect.mp4')">上舉錯誤示範影片</a>
                            <a data-role="button" href="#videoWindow" data-rel="popup" data-position-to="window" data-transition="pop" onclick="playvideo('file:///android_asset/www/video/lower_incorrect.mp4')">下放錯誤示範影片</a>
                            <a data-role="button" href="#videoWindow" data-rel="popup" data-position-to="window" data-transition="pop" onclick="playvideo('file:///android_asset/www/video/ear_incorrect.mp4')">摸耳朵錯誤示範影片</a>
                            <!--下肢正確示範-->
                            <a data-role="button" href="#videoWindow" data-rel="popup" data-position-to="window" data-transition="pop" onclick="playvideo('file:///android_asset/www/video/kick_correct.mp4')">踢腿示範影片</a>
                            <a data-role="button" href="#videoWindow" data-rel="popup" data-position-to="window" data-transition="pop" onclick="playvideo('file:///android_asset/www/video/stomach_correct.mp4')">挺腹示範影片</a>
                            <a data-role="button" href="#videoWindow" data-rel="popup" data-position-to="window" data-transition="pop" onclick="playvideo('file:///android_asset/www/video/leg_correct.mp4')">側抬腿示範影片</a>
                            <!--下肢錯誤示範-->
                            <a data-role="button" href="#videoWindow" data-rel="popup" data-position-to="window" data-transition="pop" onclick="playvideo('file:///android_asset/www/video/kick_incorrect.mp4')">踢腿錯誤示範影片</a>
                            <a data-role="button" href="#videoWindow" data-rel="popup" data-position-to="window" data-transition="pop" onclick="playvideo('file:///android_asset/www/video/leg_incorrect.mp4')">側抬腿錯誤示範影片</a>
                        </div>
                        <div class="flexslider hold_div">
                            <ul class="slides">
                                <li><img src="css/images/hand.png" /></li>
                            </ul>
                        </div>
                        <div class="flexslider demo_div" style="display:none;">
                            <ul class="slides">
                                <li><img src="css/images/lower.png" /></li>
                                <li><img src="css/images/ear.png" /></li>
                                <li><img src="css/images/raise.png" /></li>
                            </ul>
                        </div>
                    </div>
                </div>
            </div>
            <!--Track-->
            <div id="tab-3" class="tab-page">
                <div data-role="content" id="track_content">
                    <ul data-role="listview" id="SoccerPlayerList">
                    </ul>
                    <div id="uploadall_btn"><img src="img/u63.png" class="show_btns"></div>
                </div>
            </div>
            <!--e-book-->
            <div id="tab-4" class="tab-page">
                <div data-role="content" id="book_content">
                    <div class="imgdiv"><img src="css/images/hand.png"></div>
                </div>
            </div>
            <!--Stroke Scale-->
            <div id="tab-5" class="tab-page">
                <div data-role="content">
                    <h1>
                        請選擇您的性別 :
                        </h1>
                    <h2>
                        </h2>
                    <div class="ui-grid-a">
                        <div class="ui-block-a">
                            <div style=" text-align:center">
                                <img style="width: 60px; height: px" src="img/male-icon.png" />
                            </div>
                        </div>
                        <div class="ui-block-b">
                            <a data-role="button" data-transition="fade" onclick="gotoStrokeScale_male()">
                                    男性
                                </a>
                        </div>
                        <div class="ui-block-a">
                            <div style=" text-align:center">
                                <img style="width: 60px; height: px" src="img/female-icon.png" />
                            </div>
                        </div>
                        <div class="ui-block-b">
                            <a data-role="button" data-transition="fade" onclick="gotoStrokeScale_female()">
                                    女性
                                </a>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <!--tab-container-->
        <!--div data-role="footer" id="start_footer">
            </div-->
        <div data-role="popup" id="videoWindow" data-theme="a" data-overlay-theme="b" class="ui-content" style="max-width:340px; padding-bottom:2em;">
            <video id="videoTag" width="240" height="320" controls="controls">
            </video>
        </div>
    </div>
    <!--main-page-->
    <div data-role="page" id="ready-page">
        <div data-role="header" class="do-header">
            <!--返回鍵-->
            <div class="back"><img src="css/images/u24.png"></div>
            <!--動作標題-->
            <h1 class="action_h"></h1>
            <!--知訊鍵-->
            <div class="know"><img src="css/images/u23.png"></div>
        </div>
        <div data-role="content" id="ready-content">
            <div class="process_div">
                <!--進度條-->
                <p class="f-times"></p>
                <p class="t-times"></p>
            </div>
            <p class="notice_p"></p>
            <!--注意事項文字-->
            <video class="video_action" controls="controls" type="video/mp4" style="display:none;"></video>
            <img src="" class="img_action">
            <div class="btns">
                <img src="css/ready/u37.png" id="video_img">
                <img src="css/ready/u39_selected.png" id="picture_img">
                <img src="css/ready/u31.png" id="start_img">
                <!--img src="css/images/Icon_Watch_Normal.png" class="bluetooth_img"-->
                <!--img src="css/start/sound.png" id="sound_img"-->
            </div>
        </div>
    </div>
    <div data-role="page" id="do-page">
        <div data-role="header" class="do-header">
            <h1 class="action_h"></h1>
            <div class="know"><img src="css/images/u23.png"></div>
        </div>
        <div data-role="content" id="do-content">
            <div class="process_div">
                <p class="f-times"></p>
                <p class="t-times"></p>
            </div>
            <p class="notice_p"></p>
            <img src="" class="do_img">
            <p id="times"></p>
            <!--正確次數-->
            <p id="errortimes"></p>
            <!--錯誤次數-->
            <!--p id="accelerometer"></p-->
        </div>
        <div data-role="footer" id="do-back">
            <div data-role="navbar">
                <ul>
                    <li><a name="a" onclick="ctheme(this.name)" id="a" class="d">點</a></li>
                    <li><a name="b" onclick="ctheme(this.name)" id="b" class="d">我</a></li>
                    <li><a name="c" onclick="ctheme(this.name)" id="c" class="d">返</a></li>
                    <li><a name="d" onclick="ctheme(this.name)" id="d" class="d">回</a></li>
                </ul>
            </div>
        </div>
    </div>
    <div data-role="page" id="show-page">
        <div data-role="header" class="show-header">
            <div class="back"><img src="css/images/u24.png"></div>
            <h1 id="finish_h">完成</h1>
            <div class="know"><img src="css/images/u23.png"></div>
        </div>
        <div data-role="content" id="do-content">
            <div id="show_detail">
                <p id="show_date">2014 / 07/07 (Sat)</p>
                <ul>
                    <li id="show_action">
                        <img src="img/u35.png" class="show_img">
                        <div>
                            <p class="show_left">動作</p>
                            <p class="show_right" id="f_action">上舉</p>
                        </div>
                    </li>
                    <li id="show_times">
                        <img src="img/u46.png" class="show_img">
                        <div>
                            <p class="show_left">次數</p>
                            <p class="show_right" id="f_times"></p>
                        </div>
                    </li>
                    <li id="show_finish">
                        <img src="img/u57.png" class="show_img">
                        <div>
                            <p class="show_left">角度</p>
                            <p class="show_right" id="f_degree"></p>
                        </div>
                    </li>
                    <li id="show_error">
                        <img src="img/u68.png" class="show_img">
                        <div>
                            <p class="show_left">位置</p>
                            <p class="show_right" id="f_earlevel"></p>
                        </div>
                    </li>
                </ul>
            </div>
            <div id="show_point">
                <h1 id="congra">恭喜你!</br>完成了，今日的練習</h1>
                <img src="img/u9.png">
                <p id="get_point"></p>
            </div>
            <div id="upload_btn"><img src="img/u63.png" class="show_btns">
            </div>
            <div>
                <div id="again_btn"><img src="img/u65.png" class="show_btns"></div>
                <div id="leave_btn"><img src="img/u67.png" class="show_btns"></div>
            </div>
        </div>
    </div>
    <!-- 測試頁面 -->
    <div id="test-page" data-role="page">
        <button id="" onclick="showAcc()">顯示加速度</button>
        <button id="goBack" onclick="goBack()">返回首頁</button>
        <p id="test_p"></p>
    </div>
    <!-- 中風因子量表頁面 -->
    <div data-role="page" id="strokeScale">
        <div data-role="header">
            <h1>中風因子檢測量表</h1>
        </div>
        <div data-role="content">
            <li>
                Age(年紀)：
                <select id="age" data-icon="Rarrow">
                    <option value="0">54-56</option>
                    <option value="1">57-59</option>
                    <option value="2">60-62</option>
                    <option value="3">63-65</option>
                    <option value="4">66-68</option>
                    <option value="5">69-71</option>
                    <option value="6">72-74</option>
                    <option value="7">75-77</option>
                    <option value="8">78-80</option>
                    <option value="9">80-83</option>
                    <option value="10">84-86</option>
                </select>
            </li>
            <li>
                SBP(收縮壓)：
                <select id="sbp" data-icon="Rarrow">
                    <option value="0">95-104</option>
                    <option value="1">105-114</option>
                    <option value="2">115-124</option>
                    <option value="3">125-134</option>
                    <option value="4">135-144</option>
                    <option value="5">145-154</option>
                    <option value="6">155-164</option>
                    <option value="7">165-174</option>
                    <option value="8">175-184</option>
                    <option value="9">185-194</option>
                    <option value="10">195-204</option>
                </select>
            </li>
            <li>
                Hyp Rx(服降血壓藥之後的收縮壓)【無服藥則選：無服藥】：
                <select id="hyprx" data-icon="Rarrow">
                    <option value="0">無服藥</option>
                    <option value="6">95-104</option>
                    <option value="5">105-114</option>
                    <option value="5">115-124</option>
                    <option value="4">125-134</option>
                    <option value="3">135-144</option>
                    <option value="3">145-154</option>
                    <option value="2">155-164</option>
                    <option value="1">165-174</option>
                    <option value="1">175-184</option>
                    <option value="0">185-194</option>
                    <option value="0">195-204</option>
                </select>
            </li>
            <li>
                Diabetes(糖尿病史):
                <select id="diabetes" data-icon="Rarrow">
                    <option value="0">無</option>
                    <option value="3">有</option>
                </select>
            </li>
            <li>
                Cigs(抽菸習慣)：
                <select id="cigs" data-icon="Rarrow">
                    <option value="0">無</option>
                    <option value="3">有</option>
                </select>
            </li>
            <li>
                CVD(心肌梗塞、心絞痛、冠狀動脈血液灌流不足、間歇性跛行、充血性心衰竭)：
                <select id="cvd" data-icon="Rarrow">
                    <option value="0">無</option>
                    <option value="2">有</option>
                </select>
            </li>
            <li>
                AF(心房顫震病史)：
                <select id="af" data-icon="Rarrow">
                    <option value="0">無</option>
                    <option value="6">有</option>
                </select>
            </li>
            <li>
                LVH(心電圖證實左心室肥大)：
                <select id="lvh" data-icon="Rarrow">
                    <option value="0">無</option>
                    <option value="4">有</option>
                </select>
            </li>
            <br/>
            <br/>
            <br/>
            <input type="button" onclick="doOutput()" name="Submit" value="顯示評估結果">
            <br/>
            <input type="button" onclick="goBack()" value="Back">
        </div>
        <!-- /content -->
    </div>
    <!-- /page -->
</body>

</html>
